<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç›´æ¥æµ‹è¯•ç³»ç»Ÿè®¾ç½®</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.1.3/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.1.3/js/bootstrap.bundle.min.js"></script>
</head>
<body>
    <div class="container mt-4">
        <div class="card">
            <div class="card-header bg-primary text-white">
                <h3><i class="fas fa-flask"></i> ç³»ç»Ÿè®¾ç½®ç›´æ¥æµ‹è¯•</h3>
                <p class="mb-0">ç»•è¿‡ç®¡ç†å‘˜åå°æ¡†æ¶ç›´æ¥æµ‹è¯•SystemSettingsç±»</p>
            </div>
            <div class="card-body">
                <div class="alert alert-info">
                    <h6><i class="fas fa-info-circle"></i> æµ‹è¯•è¯´æ˜</h6>
                    <p>è¿™ä¸ªé¡µé¢ä¼šç›´æ¥å¯¼å…¥å¹¶å®ä¾‹åŒ–SystemSettingsç±»ï¼Œç»•è¿‡AdminAppæ¡†æ¶è¿›è¡Œæµ‹è¯•ã€‚</p>
                </div>
                
                <div class="row">
                    <div class="col-md-6">
                        <button id="test-import" class="btn btn-primary mb-2 w-100">
                            <i class="fas fa-download"></i> æµ‹è¯•å¯¼å…¥SystemSettings
                        </button>
                        <button id="test-instance" class="btn btn-success mb-2 w-100">
                            <i class="fas fa-play"></i> åˆ›å»ºå®ä¾‹
                        </button>
                        <button id="test-render" class="btn btn-warning mb-2 w-100">
                            <i class="fas fa-eye"></i> æµ‹è¯•æ¸²æŸ“
                        </button>
                    </div>
                    <div class="col-md-6">
                        <button id="test-admin-app" class="btn btn-info mb-2 w-100">
                            <i class="fas fa-cogs"></i> æµ‹è¯•AdminApp
                        </button>
                        <button id="simulate-click" class="btn btn-secondary mb-2 w-100">
                            <i class="fas fa-mouse-pointer"></i> æ¨¡æ‹Ÿèœå•ç‚¹å‡»
                        </button>
                        <button id="clear-results" class="btn btn-outline-danger mb-2 w-100">
                            <i class="fas fa-trash"></i> æ¸…é™¤ç»“æœ
                        </button>
                    </div>
                </div>
                
                <div class="mt-4">
                    <h5>æµ‹è¯•ç»“æœï¼š</h5>
                    <div id="test-results" class="alert alert-light border" style="min-height: 200px; max-height: 400px; overflow-y: auto;">
                        <p class="text-muted">ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®å¼€å§‹æµ‹è¯•...</p>
                    </div>
                </div>
                
                <div class="mt-4">
                    <h5>ç³»ç»Ÿè®¾ç½®é¡µé¢é¢„è§ˆï¼š</h5>
                    <div id="settings-preview" class="border rounded p-3" style="min-height: 300px; background: #f8f9fa;">
                        <p class="text-muted">ç­‰å¾…æ¸²æŸ“...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const colors = {
                info: '#17a2b8',
                success: '#28a745',
                warning: '#ffc107',
                error: '#dc3545'
            };
            
            const resultsDiv = document.getElementById('test-results');
            resultsDiv.innerHTML += `<div style="color: ${colors[type] || '#6c757d'}; margin-bottom: 5px;">[${timestamp}] ${message}</div>`;
            resultsDiv.scrollTop = resultsDiv.scrollHeight;
        }

        let SystemSettings = null;
        let settingsInstance = null;
        let mockApp = null;

        // åˆ›å»ºæ¨¡æ‹Ÿçš„AdminApp
        function createMockApp() {
            return {
                token: 'mock-token',
                currentPage: 'settings',
                isAuthenticated: true,
                user: { username: 'test-admin' }
            };
        }

        // æµ‹è¯•å¯¼å…¥SystemSettings
        document.getElementById('test-import').addEventListener('click', async function() {
            log('ğŸ” å¼€å§‹å¯¼å…¥SystemSettingsæ¨¡å—...', 'info');
            
            try {
                const module = await import('./src/pages/SystemSettings.js');
                SystemSettings = module.default;
                log('âœ… SystemSettingså¯¼å…¥æˆåŠŸï¼', 'success');
                log(`- ç±»å: ${SystemSettings.name}`, 'info');
                log(`- ç±»å‹: ${typeof SystemSettings}`, 'info');
            } catch (error) {
                log(`âŒ å¯¼å…¥å¤±è´¥: ${error.message}`, 'error');
                log(`é”™è¯¯è¯¦æƒ…: ${error.stack}`, 'error');
            }
        });

        // æµ‹è¯•åˆ›å»ºå®ä¾‹
        document.getElementById('test-instance').addEventListener('click', function() {
            log('ğŸ”¨ åˆ›å»ºSystemSettingså®ä¾‹...', 'info');
            
            if (!SystemSettings) {
                log('âŒ è¯·å…ˆå¯¼å…¥SystemSettingsç±»', 'error');
                return;
            }
            
            try {
                mockApp = createMockApp();
                settingsInstance = new SystemSettings(mockApp);
                log('âœ… å®ä¾‹åˆ›å»ºæˆåŠŸï¼', 'success');
                log(`- å®ä¾‹ç±»å‹: ${settingsInstance.constructor.name}`, 'info');
                log(`- appå±æ€§: ${settingsInstance.app ? 'å­˜åœ¨' : 'ä¸å­˜åœ¨'}`, 'info');
                log(`- versionInfo: ${settingsInstance.versionInfo}`, 'info');
            } catch (error) {
                log(`âŒ å®ä¾‹åˆ›å»ºå¤±è´¥: ${error.message}`, 'error');
                log(`é”™è¯¯è¯¦æƒ…: ${error.stack}`, 'error');
            }
        });

        // æµ‹è¯•æ¸²æŸ“
        document.getElementById('test-render').addEventListener('click', async function() {
            log('ğŸ¨ æµ‹è¯•SystemSettingsæ¸²æŸ“...', 'info');
            
            if (!settingsInstance) {
                log('âŒ è¯·å…ˆåˆ›å»ºSystemSettingså®ä¾‹', 'error');
                return;
            }
            
            try {
                // å…ˆåŠ è½½ç‰ˆæœ¬ä¿¡æ¯
                log('ğŸ“‹ åŠ è½½ç‰ˆæœ¬ä¿¡æ¯...', 'info');
                await settingsInstance.loadVersionInfo();
                log('âœ… ç‰ˆæœ¬ä¿¡æ¯åŠ è½½å®Œæˆ', 'success');
                
                // æ¸²æŸ“é¡µé¢
                log('ğŸ¨ å¼€å§‹æ¸²æŸ“é¡µé¢...', 'info');
                const content = settingsInstance.render();
                log('âœ… é¡µé¢æ¸²æŸ“æˆåŠŸï¼', 'success');
                
                // æ˜¾ç¤ºé¢„è§ˆ
                const previewDiv = document.getElementById('settings-preview');
                previewDiv.innerHTML = content;
                log('âœ… é¢„è§ˆå·²æ›´æ–°', 'success');
                
            } catch (error) {
                log(`âŒ æ¸²æŸ“å¤±è´¥: ${error.message}`, 'error');
                log(`é”™è¯¯è¯¦æƒ…: ${error.stack}`, 'error');
            }
        });

        // æµ‹è¯•AdminApp
        document.getElementById('test-admin-app').addEventListener('click', function() {
            log('ğŸ” æ£€æŸ¥çˆ¶é¡µé¢AdminApp...', 'info');
            
            if (window.parent && window.parent.adminApp) {
                const adminApp = window.parent.adminApp;
                log('âœ… æ‰¾åˆ°AdminAppå®ä¾‹', 'success');
                log(`- å½“å‰é¡µé¢: ${adminApp.currentPage}`, 'info');
                log(`- è®¤è¯çŠ¶æ€: ${adminApp.isAuthenticated}`, 'info');
                log(`- ç”¨æˆ·ä¿¡æ¯: ${adminApp.user ? JSON.stringify(adminApp.user) : 'null'}`, 'info');
                
                if (adminApp.pages && adminApp.pages.settings) {
                    log('âœ… settingsé¡µé¢é…ç½®å­˜åœ¨', 'success');
                    const config = adminApp.pages.settings;
                    log(`- Class: ${config.Class ? config.Class.name : 'undefined'}`, 'info');
                    log(`- renderå‡½æ•°: ${typeof config.render}`, 'info');
                    log(`- afterRenderå‡½æ•°: ${typeof config.afterRender}`, 'info');
                    log(`- instance: ${config.instance ? 'å·²åˆ›å»º' : 'æœªåˆ›å»º'}`, 'info');
                } else {
                    log('âŒ settingsé¡µé¢é…ç½®ä¸å­˜åœ¨', 'error');
                }
            } else {
                log('âŒ æœªæ‰¾åˆ°AdminAppå®ä¾‹', 'error');
                log('ğŸ’¡ è¿™ä¸ªé¡µé¢å¯èƒ½ä¸åœ¨ç®¡ç†å‘˜åå°ä¸­æ‰“å¼€', 'warning');
            }
        });

        // æ¨¡æ‹Ÿèœå•ç‚¹å‡»
        document.getElementById('simulate-click').addEventListener('click', function() {
            log('ğŸ–±ï¸ æ¨¡æ‹Ÿç‚¹å‡»ç³»ç»Ÿè®¾ç½®èœå•...', 'info');
            
            if (window.parent && window.parent.document) {
                const settingsLink = window.parent.document.querySelector('[data-page="settings"]');
                if (settingsLink) {
                    log('âœ… æ‰¾åˆ°ç³»ç»Ÿè®¾ç½®èœå•é¡¹', 'success');
                    log('ğŸš€ æ¨¡æ‹Ÿç‚¹å‡»äº‹ä»¶...', 'info');
                    
                    // åˆ›å»ºç‚¹å‡»äº‹ä»¶
                    const clickEvent = new window.parent.MouseEvent('click', {
                        bubbles: true,
                        cancelable: true,
                        view: window.parent
                    });
                    
                    // è§¦å‘ç‚¹å‡»
                    settingsLink.dispatchEvent(clickEvent);
                    log('âœ… ç‚¹å‡»äº‹ä»¶å·²è§¦å‘', 'success');
                    
                    // æ£€æŸ¥æ˜¯å¦æœ‰å˜åŒ–
                    setTimeout(() => {
                        if (window.parent.adminApp) {
                            log(`å¯¼èˆªåé¡µé¢: ${window.parent.adminApp.currentPage}`, 'info');
                        }
                    }, 1000);
                } else {
                    log('âŒ æœªæ‰¾åˆ°ç³»ç»Ÿè®¾ç½®èœå•é¡¹', 'error');
                }
            } else {
                log('âŒ æ— æ³•è®¿é—®çˆ¶é¡µé¢', 'error');
            }
        });

        // æ¸…é™¤ç»“æœ
        document.getElementById('clear-results').addEventListener('click', function() {
            document.getElementById('test-results').innerHTML = '<p class="text-muted">ç»“æœå·²æ¸…é™¤...</p>';
            document.getElementById('settings-preview').innerHTML = '<p class="text-muted">ç­‰å¾…æ¸²æŸ“...</p>';
        });

        // é¡µé¢åŠ è½½å®Œæˆ
        window.addEventListener('load', function() {
            log('ğŸš€ SystemSettingsç›´æ¥æµ‹è¯•å·¥å…·å·²åŠ è½½', 'success');
            log('ğŸ’¡ è¿™ä¸ªå·¥å…·ä¼šç»•è¿‡AdminAppæ¡†æ¶ç›´æ¥æµ‹è¯•SystemSettingsåŠŸèƒ½', 'info');
        });
    </script>
</body>
</html>
