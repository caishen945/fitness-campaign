<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¶…çº§ç¼“å­˜æ¸…ç† - FitChallenge</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            margin: 0;
            padding: 20px;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .container {
            background: white;
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            max-width: 600px;
            width: 100%;
            text-align: center;
        }
        h1 {
            color: #333;
            margin-bottom: 30px;
        }
        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            margin: 10px;
            transition: all 0.3s ease;
        }
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        .status {
            margin: 20px 0;
            padding: 15px;
            border-radius: 8px;
            font-weight: bold;
        }
        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .status.warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
        .info {
            margin: 15px 0;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 5px;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸš¨ è¶…çº§ç¼“å­˜æ¸…ç†å·¥å…·</h1>
        <div class="info">
            <strong>å½“å‰é—®é¢˜ï¼š</strong>æµè§ˆå™¨ç¼“å­˜äº†æ—§ç‰ˆæœ¬æ„å»ºæ–‡ä»¶ <code>index-jcS3Ci04.js</code><br>
            <strong>è§£å†³æ–¹æ¡ˆï¼š</strong>å½»åº•æ¸…ç†æ‰€æœ‰ç¼“å­˜å¹¶å¼ºåˆ¶é‡æ–°åŠ è½½
        </div>
        
        <div id="status" class="status warning">
            å‡†å¤‡æ¸…ç†ç¼“å­˜...
        </div>
        
        <button class="btn" onclick="superCacheClear()">ğŸ”¥ æ‰§è¡Œè¶…çº§ç¼“å­˜æ¸…ç†</button>
        <button class="btn" onclick="forceReload()">ğŸ”„ å¼ºåˆ¶é‡æ–°åŠ è½½</button>
        <button class="btn" onclick="clearSpecificCache()">ğŸ¯ æ¸…ç†ç‰¹å®šç¼“å­˜</button>
        <button class="btn" onclick="goToAdmin()">ğŸ  è¿”å›ç®¡ç†åå°</button>
        
        <div class="info">
            <strong>æ¸…ç†æ­¥éª¤ï¼š</strong><br>
            1. æ¸…ç†æ‰€æœ‰æœ¬åœ°å­˜å‚¨<br>
            2. æ¸…ç†Service Worker<br>
            3. æ¸…ç†HTTPç¼“å­˜<br>
            4. æ·»åŠ éšæœºå‚æ•°å¼ºåˆ¶åˆ·æ–°<br>
            5. é‡å®šå‘åˆ°æœ€æ–°ç‰ˆæœ¬
        </div>
    </div>

    <script>
        // è¶…çº§ç¼“å­˜æ¸…ç†å‡½æ•°
        async function superCacheClear() {
            const statusDiv = document.getElementById('status');
            
            try {
                statusDiv.className = 'status warning';
                statusDiv.innerHTML = 'ğŸ”„ æ­£åœ¨æ‰§è¡Œè¶…çº§ç¼“å­˜æ¸…ç†...';
                
                // 1. æ¸…ç†æ‰€æœ‰æœ¬åœ°å­˜å‚¨
                localStorage.clear();
                sessionStorage.clear();
                console.log('âœ… æœ¬åœ°å­˜å‚¨å·²æ¸…ç†');
                
                // 2. æ¸…ç†IndexedDB
                if ('indexedDB' in window) {
                    const databases = await indexedDB.databases();
                    for (const db of databases) {
                        indexedDB.deleteDatabase(db.name);
                    }
                    console.log('âœ… IndexedDBå·²æ¸…ç†');
                }
                
                // 3. æ¸…ç†Service Worker
                if ('serviceWorker' in navigator) {
                    const registrations = await navigator.serviceWorker.getRegistrations();
                    for (const registration of registrations) {
                        await registration.unregister();
                    }
                    console.log('âœ… Service Workerå·²æ¸…ç†');
                }
                
                // 4. æ¸…ç†Cache API
                if ('caches' in window) {
                    const cacheNames = await caches.keys();
                    for (const cacheName of cacheNames) {
                        await caches.delete(cacheName);
                    }
                    console.log('âœ… Cache APIå·²æ¸…ç†');
                }
                
                // 5. æ¸…ç†Cookiesï¼ˆç®¡ç†åå°ç›¸å…³ï¼‰
                const cookies = document.cookie.split(";");
                for (let cookie of cookies) {
                    const eqPos = cookie.indexOf("=");
                    const name = eqPos > -1 ? cookie.substr(0, eqPos).trim() : cookie.trim();
                    document.cookie = name + "=;expires=Thu, 01 Jan 1970 00:00:00 GMT;path=/";
                }
                console.log('âœ… Cookieså·²æ¸…ç†');
                
                statusDiv.className = 'status success';
                statusDiv.innerHTML = 'ğŸ‰ è¶…çº§ç¼“å­˜æ¸…ç†å®Œæˆï¼å³å°†å¼ºåˆ¶é‡æ–°åŠ è½½...';
                
                // 6. ç­‰å¾…2ç§’åå¼ºåˆ¶é‡æ–°åŠ è½½
                setTimeout(() => {
                    forceReload();
                }, 2000);
                
            } catch (error) {
                console.error('ç¼“å­˜æ¸…ç†å¤±è´¥:', error);
                statusDiv.className = 'status error';
                statusDiv.innerHTML = 'âŒ ç¼“å­˜æ¸…ç†å¤±è´¥: ' + error.message;
            }
        }
        
        // å¼ºåˆ¶é‡æ–°åŠ è½½
        function forceReload() {
            const timestamp = new Date().getTime();
            const random = Math.random().toString(36).substring(2);
            const cacheBuster = `?v=${timestamp}&r=${random}&force=true`;
            
            // å¼ºåˆ¶é‡æ–°åŠ è½½å½“å‰é¡µé¢
            window.location.href = window.location.pathname + cacheBuster;
        }
        
        // æ¸…ç†ç‰¹å®šç¼“å­˜
        async function clearSpecificCache() {
            const statusDiv = document.getElementById('status');
            
            try {
                statusDiv.className = 'status warning';
                statusDiv.innerHTML = 'ğŸ¯ æ­£åœ¨æ¸…ç†ç‰¹å®šç¼“å­˜æ–‡ä»¶...';
                
                // åˆ›å»ºæ–°çš„scriptæ ‡ç­¾ï¼Œå¼ºåˆ¶é‡æ–°åŠ è½½
                const oldScripts = document.querySelectorAll('script[src*="index-"]');
                oldScripts.forEach(script => script.remove());
                
                // å¼ºåˆ¶æ¸…ç†ç‰¹å®šç¼“å­˜æ¡ç›®
                if ('caches' in window) {
                    const cacheNames = await caches.keys();
                    for (const cacheName of cacheNames) {
                        const cache = await caches.open(cacheName);
                        const requests = await cache.keys();
                        for (const request of requests) {
                            if (request.url.includes('index-') || request.url.includes('.js')) {
                                await cache.delete(request);
                                console.log('åˆ é™¤ç¼“å­˜:', request.url);
                            }
                        }
                    }
                }
                
                statusDiv.className = 'status success';
                statusDiv.innerHTML = 'ğŸ¯ ç‰¹å®šç¼“å­˜æ¸…ç†å®Œæˆï¼';
                
            } catch (error) {
                console.error('ç‰¹å®šç¼“å­˜æ¸…ç†å¤±è´¥:', error);
                statusDiv.className = 'status error';
                statusDiv.innerHTML = 'âŒ ç‰¹å®šç¼“å­˜æ¸…ç†å¤±è´¥: ' + error.message;
            }
        }
        
        // è¿”å›ç®¡ç†åå°
        function goToAdmin() {
            const timestamp = new Date().getTime();
            const random = Math.random().toString(36).substring(2);
            window.location.href = `./index.html?v=${timestamp}&r=${random}&cleared=true`;
        }
        
        // é¡µé¢åŠ è½½æ—¶æ˜¾ç¤ºå½“å‰çŠ¶æ€
        window.onload = function() {
            const statusDiv = document.getElementById('status');
            statusDiv.className = 'status warning';
            statusDiv.innerHTML = `
                ğŸ” æ£€æµ‹åˆ°ç¼“å­˜é—®é¢˜<br>
                <small>å½“å‰ç‰ˆæœ¬: 3.0.1 (ç¼“å­˜ç‰ˆæœ¬)</small><br>
                <small>ç›®æ ‡ç‰ˆæœ¬: 3.2.0 (æœ€æ–°ç‰ˆæœ¬)</small><br>
                <small>é—®é¢˜æ–‡ä»¶: index-jcS3Ci04.js (å·²ç¼“å­˜)</small>
            `;
        };
    </script>
</body>
</html>
