<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç³»ç»Ÿè®¾ç½®æµ‹è¯• - FitChallenge</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; line-height: 1.6; }
        .test-section { margin: 20px 0; padding: 20px; border: 1px solid #ddd; border-radius: 8px; }
        .test-title { font-size: 1.2rem; font-weight: bold; margin-bottom: 10px; color: #2c3e50; }
        .success { color: #27ae60; }
        .error { color: #e74c3c; }
        .warning { color: #f39c12; }
        .info { color: #3498db; }
        #console { background: #2c3e50; color: #ecf0f1; padding: 15px; border-radius: 5px; height: 300px; overflow-y: auto; font-family: monospace; font-size: 12px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”§ ç³»ç»Ÿè®¾ç½®åŠŸèƒ½æµ‹è¯•</h1>
        
        <div class="test-section">
            <div class="test-title">æµ‹è¯•è¯´æ˜</div>
            <p>æœ¬é¡µé¢ç”¨äºæµ‹è¯•ç³»ç»Ÿè®¾ç½®é¡µé¢çš„åŠŸèƒ½ï¼š</p>
            <ul>
                <li>âœ… éªŒè¯SystemSettingsç±»æ˜¯å¦æ­£ç¡®åŠ è½½</li>
                <li>âœ… æµ‹è¯•ç‰ˆæœ¬ä¿¡æ¯åŠ è½½åŠŸèƒ½</li>
                <li>âœ… æµ‹è¯•é¡µé¢æ¸²æŸ“åŠŸèƒ½</li>
                <li>âœ… æ£€æŸ¥å¯¼èˆªèœå•æ˜¯å¦æ­£ç¡®é…ç½®</li>
            </ul>
        </div>

        <div class="test-section">
            <div class="test-title">1. æµ‹è¯•SystemSettingsç±»åŠ è½½</div>
            <button id="test-class" class="btn btn-primary">æµ‹è¯•ç±»åŠ è½½</button>
            <div id="class-result" class="mt-2"></div>
        </div>

        <div class="test-section">
            <div class="test-title">2. æµ‹è¯•é¡µé¢æ¸²æŸ“</div>
            <button id="test-render" class="btn btn-success">æµ‹è¯•é¡µé¢æ¸²æŸ“</button>
            <div id="render-result" class="mt-2"></div>
        </div>

        <div class="test-section">
            <div class="test-title">3. æ£€æŸ¥å¯¼èˆªé…ç½®</div>
            <button id="test-navigation" class="btn btn-info">æ£€æŸ¥å¯¼èˆªé…ç½®</button>
            <div id="navigation-result" class="mt-2"></div>
        </div>

        <div class="test-section">
            <div class="test-title">4. è·³è½¬åˆ°ç®¡ç†å‘˜ç³»ç»Ÿ</div>
            <button id="go-to-admin" class="btn btn-primary">è·³è½¬åˆ°ç®¡ç†å‘˜ç³»ç»Ÿ</button>
            <div class="mt-2">
                <small class="text-muted">ç‚¹å‡»åå°†è·³è½¬åˆ° http://127.0.0.1:8081ï¼Œè¯·å…ˆç™»å½•åç‚¹å‡»ç³»ç»Ÿè®¾ç½®</small>
            </div>
        </div>

        <div class="test-section">
            <div class="test-title">å®æ—¶æ§åˆ¶å°æ—¥å¿—</div>
            <div id="console"></div>
            <button id="clear-console" class="btn btn-sm btn-secondary mt-2">æ¸…é™¤æ—¥å¿—</button>
        </div>
    </div>

    <script type="module">
        // æ—¥å¿—åŠŸèƒ½
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const console = document.getElementById('console');
            const colorMap = {
                'success': '#27ae60',
                'error': '#e74c3c',
                'warning': '#f39c12',
                'info': '#3498db'
            };
            
            console.innerHTML += `<div style="color: ${colorMap[type] || '#ecf0f1'};">[${timestamp}] ${message}</div>`;
            console.scrollTop = console.scrollHeight;
        }

        // 1. æµ‹è¯•SystemSettingsç±»åŠ è½½
        document.getElementById('test-class').addEventListener('click', async () => {
            const resultEl = document.getElementById('class-result');
            log('å¼€å§‹æµ‹è¯•SystemSettingsç±»åŠ è½½...', 'info');
            
            try {
                // å°è¯•å¯¼å…¥SystemSettingsç±»
                const SystemSettingsModule = await import('./src/pages/SystemSettings.js');
                const SystemSettings = SystemSettingsModule.default;
                
                if (SystemSettings) {
                    log('âœ… SystemSettingsç±»åŠ è½½æˆåŠŸ', 'success');
                    
                    // åˆ›å»ºå®ä¾‹æµ‹è¯•
                    const mockApp = { user: { username: 'test' } };
                    const instance = new SystemSettings(mockApp);
                    
                    if (instance) {
                        log('âœ… SystemSettingså®ä¾‹åˆ›å»ºæˆåŠŸ', 'success');
                        
                        // æ£€æŸ¥å¿…è¦æ–¹æ³•
                        const methods = ['render', 'loadVersionInfo', 'setupEventListeners'];
                        const methodResults = methods.map(method => ({
                            method,
                            exists: typeof instance[method] === 'function'
                        }));
                        
                        log(`æ–¹æ³•æ£€æŸ¥ç»“æœ: ${JSON.stringify(methodResults)}`, 'info');
                        
                        resultEl.innerHTML = `
                            <div class="alert alert-success">
                                âœ… SystemSettingsç±»åŠ è½½æˆåŠŸ<br>
                                å®ä¾‹: ${instance.constructor.name}<br>
                                æ–¹æ³•: ${methodResults.filter(m => m.exists).map(m => m.method).join(', ')}
                            </div>
                        `;
                    } else {
                        throw new Error('å®ä¾‹åˆ›å»ºå¤±è´¥');
                    }
                } else {
                    throw new Error('SystemSettingsç±»æœªæ‰¾åˆ°');
                }
            } catch (error) {
                log(`âŒ SystemSettingsç±»åŠ è½½å¤±è´¥: ${error.message}`, 'error');
                resultEl.innerHTML = `<div class="alert alert-danger">âŒ åŠ è½½å¤±è´¥: ${error.message}</div>`;
            }
        });

        // 2. æµ‹è¯•é¡µé¢æ¸²æŸ“
        document.getElementById('test-render').addEventListener('click', async () => {
            const resultEl = document.getElementById('render-result');
            log('å¼€å§‹æµ‹è¯•é¡µé¢æ¸²æŸ“...', 'info');
            
            try {
                const SystemSettingsModule = await import('./src/pages/SystemSettings.js');
                const SystemSettings = SystemSettingsModule.default;
                
                const mockApp = { 
                    user: { username: 'testuser' },
                    showToast: (msg, type) => log(`Toast: ${msg} (${type})`, 'info')
                };
                const instance = new SystemSettings(mockApp);
                
                // åŠ è½½ç‰ˆæœ¬ä¿¡æ¯
                await instance.loadVersionInfo();
                log('âœ… ç‰ˆæœ¬ä¿¡æ¯åŠ è½½å®Œæˆ', 'success');
                
                // æ¸²æŸ“é¡µé¢
                const content = instance.render();
                
                if (content && content.includes('ç³»ç»Ÿè®¾ç½®')) {
                    log('âœ… é¡µé¢æ¸²æŸ“æˆåŠŸ', 'success');
                    resultEl.innerHTML = `
                        <div class="alert alert-success">
                            âœ… é¡µé¢æ¸²æŸ“æˆåŠŸ<br>
                            å†…å®¹é•¿åº¦: ${content.length} å­—ç¬¦<br>
                            åŒ…å«å…³é”®è¯: ${content.includes('ç‰ˆæœ¬æ§åˆ¶') ? 'ç‰ˆæœ¬æ§åˆ¶ âœ“' : ''} ${content.includes('ç³»ç»ŸçŠ¶æ€') ? 'ç³»ç»ŸçŠ¶æ€ âœ“' : ''}
                        </div>
                        <details class="mt-2">
                            <summary>æŸ¥çœ‹æ¸²æŸ“å†…å®¹é¢„è§ˆ</summary>
                            <div style="max-height: 200px; overflow: auto; border: 1px solid #ddd; padding: 10px; margin-top: 10px;">
                                ${content.substring(0, 500)}...
                            </div>
                        </details>
                    `;
                } else {
                    throw new Error('æ¸²æŸ“å†…å®¹æ— æ•ˆ');
                }
            } catch (error) {
                log(`âŒ é¡µé¢æ¸²æŸ“å¤±è´¥: ${error.message}`, 'error');
                resultEl.innerHTML = `<div class="alert alert-danger">âŒ æ¸²æŸ“å¤±è´¥: ${error.message}</div>`;
            }
        });

        // 3. æ£€æŸ¥å¯¼èˆªé…ç½®
        document.getElementById('test-navigation').addEventListener('click', async () => {
            const resultEl = document.getElementById('navigation-result');
            log('å¼€å§‹æ£€æŸ¥å¯¼èˆªé…ç½®...', 'info');
            
            try {
                // å°è¯•å¯¼å…¥App-fixed.js
                const AppModule = await import('./src/App-fixed.js');
                const AdminApp = AppModule.default;
                
                if (AdminApp) {
                    log('âœ… AdminAppç±»åŠ è½½æˆåŠŸ', 'success');
                    
                    // åˆ›å»ºå®ä¾‹æ£€æŸ¥é¡µé¢é…ç½®
                    const app = new AdminApp();
                    
                    // æ£€æŸ¥pagesé…ç½®
                    const hasSettings = app.pages && app.pages.settings;
                    const settingsConfig = app.pages.settings;
                    
                    log(`é¡µé¢é…ç½®æ£€æŸ¥: settingså­˜åœ¨=${!!hasSettings}`, 'info');
                    
                    if (hasSettings) {
                        log(`settingsé…ç½®: ${JSON.stringify({
                            hasClass: !!settingsConfig.Class,
                            hasRender: typeof settingsConfig.render === 'function',
                            hasAfterRender: typeof settingsConfig.afterRender === 'function'
                        })}`, 'info');
                        
                        resultEl.innerHTML = `
                            <div class="alert alert-success">
                                âœ… å¯¼èˆªé…ç½®æ£€æŸ¥æˆåŠŸ<br>
                                settingsé¡µé¢: å·²é…ç½® âœ“<br>
                                Class: ${settingsConfig.Class ? settingsConfig.Class.name : 'æœªé…ç½®'}<br>
                                renderæ–¹æ³•: ${typeof settingsConfig.render === 'function' ? 'âœ“' : 'âœ—'}<br>
                                afterRenderæ–¹æ³•: ${typeof settingsConfig.afterRender === 'function' ? 'âœ“' : 'âœ—'}
                            </div>
                        `;
                    } else {
                        throw new Error('settingsé¡µé¢é…ç½®æœªæ‰¾åˆ°');
                    }
                } else {
                    throw new Error('AdminAppç±»æœªæ‰¾åˆ°');
                }
            } catch (error) {
                log(`âŒ å¯¼èˆªé…ç½®æ£€æŸ¥å¤±è´¥: ${error.message}`, 'error');
                resultEl.innerHTML = `<div class="alert alert-danger">âŒ æ£€æŸ¥å¤±è´¥: ${error.message}</div>`;
            }
        });

        // 4. è·³è½¬åˆ°ç®¡ç†å‘˜ç³»ç»Ÿ
        document.getElementById('go-to-admin').addEventListener('click', () => {
            log('ğŸ”„ è·³è½¬åˆ°ç®¡ç†å‘˜ç³»ç»Ÿ', 'info');
            window.location.href = 'http://127.0.0.1:8081';
        });

        // æ¸…é™¤æ§åˆ¶å°
        document.getElementById('clear-console').addEventListener('click', () => {
            document.getElementById('console').innerHTML = '';
        });

        // é¡µé¢åŠ è½½æ—¶çš„åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            log('ğŸš€ ç³»ç»Ÿè®¾ç½®æµ‹è¯•é¡µé¢å·²åŠ è½½', 'success');
            log('å‡†å¤‡æµ‹è¯•ç³»ç»Ÿè®¾ç½®åŠŸèƒ½...', 'info');
            
            // è‡ªåŠ¨æ‰§è¡ŒåŸºç¡€æµ‹è¯•
            setTimeout(() => {
                document.getElementById('test-class').click();
            }, 500);
        });
    </script>
</body>
</html>