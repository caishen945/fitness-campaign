<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¯¼èˆªè°ƒè¯• - FitChallenge</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; line-height: 1.6; }
        .debug-section { margin: 20px 0; padding: 20px; border: 1px solid #ddd; border-radius: 8px; }
        .debug-title { font-size: 1.2rem; font-weight: bold; margin-bottom: 10px; color: #2c3e50; }
        #console { background: #2c3e50; color: #ecf0f1; padding: 15px; border-radius: 5px; height: 400px; overflow-y: auto; font-family: monospace; font-size: 12px; }
        .nav-test { margin: 10px 0; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” å¯¼èˆªåŠŸèƒ½è°ƒè¯•</h1>
        
        <div class="debug-section">
            <div class="debug-title">ç³»ç»Ÿè®¾ç½®å¯¼èˆªæµ‹è¯•</div>
            <p>æµ‹è¯•æ‰€æœ‰å¯èƒ½å½±å“ç³»ç»Ÿè®¾ç½®å¯¼èˆªçš„å› ç´ ï¼š</p>
            
            <div class="nav-test">
                <button id="test-direct-navigate" class="btn btn-primary">ç›´æ¥è°ƒç”¨navigate('settings')</button>
            </div>
            
            <div class="nav-test">
                <button id="test-keyboard-shortcut" class="btn btn-success">æ¨¡æ‹Ÿé”®ç›˜å¿«æ·é”® Ctrl+9</button>
            </div>
            
            <div class="nav-test">
                <button id="test-click-event" class="btn btn-info">æ¨¡æ‹Ÿç‚¹å‡»å¯¼èˆªé“¾æ¥</button>
            </div>
            
            <div class="nav-test">
                <button id="test-page-config" class="btn btn-warning">æ£€æŸ¥é¡µé¢é…ç½®</button>
            </div>
        </div>

        <div class="debug-section">
            <div class="debug-title">æ¨¡æ‹Ÿå¯¼èˆªèœå•</div>
            <div class="card">
                <div class="card-body">
                    <ul style="list-style: none; padding: 0;">
                        <li style="margin: 5px 0;">
                            <a href="#" data-page="dashboard" class="nav-link" style="color: #2c3e50; text-decoration: none; padding: 10px; display: block; border: 1px solid #ddd; border-radius: 5px;">
                                <i class="fas fa-tachometer-alt"></i> ä»ªè¡¨ç›˜ (dashboard)
                            </a>
                        </li>
                        <li style="margin: 5px 0;">
                            <a href="#" data-page="users" class="nav-link" style="color: #2c3e50; text-decoration: none; padding: 10px; display: block; border: 1px solid #ddd; border-radius: 5px;">
                                <i class="fas fa-users"></i> ç”¨æˆ·ç®¡ç† (users)
                            </a>
                        </li>
                        <li style="margin: 5px 0;">
                            <a href="#" data-page="settings" class="nav-link" style="color: #2c3e50; text-decoration: none; padding: 10px; display: block; border: 1px solid #ddd; border-radius: 5px; background: #e8f5e8;">
                                <i class="fas fa-cogs"></i> ç³»ç»Ÿè®¾ç½® (settings) â† æµ‹è¯•ç›®æ ‡
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="debug-section">
            <div class="debug-title">å®æ—¶è°ƒè¯•æ—¥å¿—</div>
            <div id="console"></div>
            <button id="clear-console" class="btn btn-sm btn-secondary mt-2">æ¸…é™¤æ—¥å¿—</button>
        </div>
    </div>

    <script type="module">
        // æ—¥å¿—åŠŸèƒ½
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const console = document.getElementById('console');
            const colorMap = {
                'success': '#27ae60',
                'error': '#e74c3c',
                'warning': '#f39c12',
                'info': '#3498db'
            };
            
            console.innerHTML += `<div style="color: ${colorMap[type] || '#ecf0f1'};">[${timestamp}] ${message}</div>`;
            console.scrollTop = console.scrollHeight;
        }

        // å…¨å±€å˜é‡å­˜å‚¨AdminAppå®ä¾‹
        let adminApp = null;

        // åˆå§‹åŒ–AdminApp
        async function initAdminApp() {
            try {
                log('ğŸš€ å¼€å§‹åˆå§‹åŒ–AdminApp...', 'info');
                
                const AppModule = await import('./src/App-fixed.js');
                const AdminApp = AppModule.default;
                
                adminApp = new AdminApp();
                
                // æ¨¡æ‹Ÿç™»å½•çŠ¶æ€
                adminApp.isAuthenticated = true;
                adminApp.user = { username: 'debug_user' };
                adminApp.token = 'debug_token';
                
                log('âœ… AdminAppåˆå§‹åŒ–æˆåŠŸ', 'success');
                log(`é¡µé¢é…ç½®: ${Object.keys(adminApp.pages).join(', ')}`, 'info');
                
                return adminApp;
            } catch (error) {
                log(`âŒ AdminAppåˆå§‹åŒ–å¤±è´¥: ${error.message}`, 'error');
                throw error;
            }
        }

        // æµ‹è¯•ç›´æ¥å¯¼èˆª
        document.getElementById('test-direct-navigate').addEventListener('click', async () => {
            log('ğŸ§ª æµ‹è¯•ç›´æ¥å¯¼èˆªåˆ°settingsé¡µé¢...', 'info');
            
            try {
                if (!adminApp) {
                    await initAdminApp();
                }
                
                log('ğŸ“ å½“å‰é¡µé¢: ' + adminApp.currentPage, 'info');
                log('ğŸ”’ è®¤è¯çŠ¶æ€: ' + adminApp.isAuthenticated, 'info');
                
                // ç›´æ¥è°ƒç”¨navigateæ–¹æ³•
                adminApp.navigate('settings');
                
                log('âœ… navigateæ–¹æ³•è°ƒç”¨å®Œæˆ', 'success');
                log('ğŸ“ å¯¼èˆªåé¡µé¢: ' + adminApp.currentPage, 'info');
                
            } catch (error) {
                log(`âŒ ç›´æ¥å¯¼èˆªå¤±è´¥: ${error.message}`, 'error');
                console.error('è¯¦ç»†é”™è¯¯:', error);
            }
        });

        // æµ‹è¯•é”®ç›˜å¿«æ·é”®
        document.getElementById('test-keyboard-shortcut').addEventListener('click', async () => {
            log('âŒ¨ï¸ æµ‹è¯•é”®ç›˜å¿«æ·é”® Ctrl+9...', 'info');
            
            try {
                if (!adminApp) {
                    await initAdminApp();
                }
                
                // åˆ›å»ºé”®ç›˜äº‹ä»¶
                const event = new KeyboardEvent('keydown', {
                    key: '9',
                    ctrlKey: true,
                    bubbles: true
                });
                
                log('ğŸ¯ æ´¾å‘é”®ç›˜äº‹ä»¶...', 'info');
                document.dispatchEvent(event);
                
                setTimeout(() => {
                    log('ğŸ“ é”®ç›˜äº‹ä»¶åé¡µé¢: ' + adminApp.currentPage, 'info');
                }, 100);
                
            } catch (error) {
                log(`âŒ é”®ç›˜å¿«æ·é”®æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
            }
        });

        // æµ‹è¯•ç‚¹å‡»äº‹ä»¶
        document.getElementById('test-click-event').addEventListener('click', async () => {
            log('ğŸ–±ï¸ æµ‹è¯•ç‚¹å‡»å¯¼èˆªé“¾æ¥...', 'info');
            
            try {
                if (!adminApp) {
                    await initAdminApp();
                }
                
                // æ‰¾åˆ°settingsé“¾æ¥å¹¶æ¨¡æ‹Ÿç‚¹å‡»
                const settingsLink = document.querySelector('[data-page="settings"]');
                if (settingsLink) {
                    log('ğŸ¯ æ‰¾åˆ°settingsé“¾æ¥ï¼Œæ¨¡æ‹Ÿç‚¹å‡»...', 'info');
                    
                    const clickEvent = new MouseEvent('click', {
                        bubbles: true,
                        cancelable: true
                    });
                    
                    settingsLink.dispatchEvent(clickEvent);
                    
                    setTimeout(() => {
                        log('ğŸ“ ç‚¹å‡»äº‹ä»¶åé¡µé¢: ' + adminApp.currentPage, 'info');
                    }, 100);
                } else {
                    log('âŒ æœªæ‰¾åˆ°settingsé“¾æ¥', 'error');
                }
                
            } catch (error) {
                log(`âŒ ç‚¹å‡»äº‹ä»¶æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
            }
        });

        // æµ‹è¯•é¡µé¢é…ç½®
        document.getElementById('test-page-config').addEventListener('click', async () => {
            log('ğŸ” æ£€æŸ¥é¡µé¢é…ç½®è¯¦æƒ…...', 'info');
            
            try {
                if (!adminApp) {
                    await initAdminApp();
                }
                
                const settingsPage = adminApp.pages.settings;
                
                log('ğŸ“‹ settingsé¡µé¢é…ç½®:', 'info');
                log(`  - å­˜åœ¨: ${!!settingsPage}`, 'info');
                log(`  - ç±»: ${settingsPage?.Class?.name || 'æœªå®šä¹‰'}`, 'info');
                log(`  - renderæ–¹æ³•: ${typeof settingsPage?.render}`, 'info');
                log(`  - afterRenderæ–¹æ³•: ${typeof settingsPage?.afterRender}`, 'info');
                log(`  - å®ä¾‹: ${!!settingsPage?.instance}`, 'info');
                
                // å°è¯•åˆ›å»ºå®ä¾‹
                if (settingsPage && settingsPage.Class) {
                    try {
                        const instance = new settingsPage.Class(adminApp);
                        log('âœ… SystemSettingså®ä¾‹åˆ›å»ºæˆåŠŸ', 'success');
                        log(`  - å®ä¾‹ç±»å‹: ${instance.constructor.name}`, 'info');
                        log(`  - renderæ–¹æ³•: ${typeof instance.render}`, 'info');
                        
                        // å°è¯•æ¸²æŸ“
                        await instance.loadVersionInfo();
                        const content = instance.render();
                        log(`âœ… é¡µé¢æ¸²æŸ“æˆåŠŸï¼Œå†…å®¹é•¿åº¦: ${content.length}`, 'success');
                        
                    } catch (renderError) {
                        log(`âŒ å®ä¾‹åˆ›å»ºæˆ–æ¸²æŸ“å¤±è´¥: ${renderError.message}`, 'error');
                    }
                }
                
            } catch (error) {
                log(`âŒ é¡µé¢é…ç½®æ£€æŸ¥å¤±è´¥: ${error.message}`, 'error');
            }
        });

        // è®¾ç½®å¯¼èˆªé“¾æ¥çš„ç‚¹å‡»äº‹ä»¶ï¼ˆæ¨¡æ‹ŸçœŸå®ç¯å¢ƒï¼‰
        document.addEventListener('click', (e) => {
            if (e.target.matches('[data-page]')) {
                e.preventDefault();
                const page = e.target.getAttribute('data-page');
                log(`ğŸ”— å¯¼èˆªé“¾æ¥è¢«ç‚¹å‡»: ${page}`, 'info');
                
                if (adminApp) {
                    adminApp.navigate(page);
                } else {
                    log('âŒ AdminAppæœªåˆå§‹åŒ–', 'error');
                }
            }
        });

        // æ¸…é™¤æ§åˆ¶å°
        document.getElementById('clear-console').addEventListener('click', () => {
            document.getElementById('console').innerHTML = '';
        });

        // é¡µé¢åŠ è½½æ—¶çš„åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            log('ğŸš€ å¯¼èˆªè°ƒè¯•é¡µé¢å·²åŠ è½½', 'success');
            log('å‡†å¤‡å¼€å§‹è°ƒè¯•å¯¼èˆªåŠŸèƒ½...', 'info');
            log('ğŸ’¡ æç¤º: è¯·æŒ‰é¡ºåºç‚¹å‡»æµ‹è¯•æŒ‰é’®', 'warning');
        });
    </script>
</body>
</html>
