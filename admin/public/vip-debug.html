<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VIPè°ƒè¯•é¡µé¢ - å¼ºåˆ¶æ— ç¼“å­?/title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f0f0f0; }
        .container { max-width: 1000px; margin: 0 auto; background: white; padding: 20px; border-radius: 10px; }
        .result { padding: 15px; margin: 10px 0; border-radius: 5px; border-left: 4px solid; }
        .success { background: #d4edda; color: #155724; border-color: #28a745; }
        .error { background: #f8d7da; color: #721c24; border-color: #dc3545; }
        .info { background: #d1ecf1; color: #0c5460; border-color: #17a2b8; }
        button { padding: 12px 24px; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; margin: 5px; }
        button:hover { background: #0056b3; }
        table { border-collapse: collapse; width: 100%; margin: 20px 0; }
        th, td { border: 1px solid #ddd; padding: 12px; text-align: left; }
        th { background-color: #f8f9fa; font-weight: bold; }
        .highlight { background-color: #fff3cd; }
        .timestamp { font-size: 12px; color: #666; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”§ VIPæ•°æ®è°ƒè¯•é¡µé¢</h1>
        <p class="timestamp">é¡µé¢åŠ è½½æ—¶é—´: <span id="loadTime"></span></p>
        
        <div>
            <button onclick="testAPI()">ğŸ” æµ‹è¯•APIæ•°æ®</button>
            <button onclick="testUpdate()">âœï¸ æµ‹è¯•æ›´æ–°VIPç­‰çº§2</button>
            <button onclick="clearResults()">ğŸ—‘ï¸?æ¸…ç©ºç»“æœ</button>
        </div>
        
        <div id="result"></div>
    </div>

    <script>
        // æ˜¾ç¤ºé¡µé¢åŠ è½½æ—¶é—´
        document.getElementById('loadTime').textContent = new Date().toLocaleString();
        
        function clearResults() {
            document.getElementById('result').innerHTML = '';
        }
        
        function addResult(type, title, content) {
            const resultDiv = document.getElementById('result');
            const timestamp = new Date().toLocaleTimeString();
            resultDiv.innerHTML += `
                <div class="result ${type}">
                    <h3>${title}</h3>
                    <p class="timestamp">æ—¶é—´: ${timestamp}</p>
                    ${content}
                </div>
            `;
        }
        
        async function testAPI() {
            addResult('info', 'ğŸ”„ å¼€å§‹æµ‹è¯•API', 'æ­£åœ¨è·å–VIPç­‰çº§æ•°æ®...');
            
            try {
                const response = await fetch('http://localhost:3000/api/admin/vip-levels', {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                        'Cache-Control': 'no-cache',
                        'Pragma': 'no-cache'
                    }
                });
                
                const data = await response.json();
                
                if (data.success) {
                    let html = '<h4>âœ?APIè°ƒç”¨æˆåŠŸ</h4>';
                    html += '<p><strong>è¿”å›æ•°æ®:</strong></p>';
                    html += '<pre>' + JSON.stringify(data, null, 2) + '</pre>';
                    
                    html += '<h4>ğŸ“Š æ•°æ®è¡¨æ ¼:</h4>';
                    html += '<table>';
                    html += '<tr><th>ID</th><th>åç§°</th><th>æŠ¼é‡‘</th><th>æ­¥æ•°ç›®æ ‡</th><th>æ¯æ—¥å¥–åŠ±</th><th>æŒ‘æˆ˜å¤©æ•°</th><th>æœ€å¤§æŒ‘æˆ˜æ¬¡æ•?/th><th>çŠ¶æ€?/th></tr>';
                    
                    data.data.forEach(level => {
                        const isVip2 = level.id === 2;
                        html += `<tr ${isVip2 ? 'class="highlight"' : ''}>
                            <td>${level.id}</td>
                            <td>${level.name || 'N/A'}</td>
                            <td>${level.depositAmount || 'N/A'}</td>
                            <td>${level.stepTarget || 'N/A'}</td>
                            <td>${level.dailyReward || 'N/A'}</td>
                            <td>${level.duration || 'N/A'}</td>
                            <td>${level.maxChallenges || 'N/A'}</td>
                            <td>${level.isActive ? 'âœ?æ¿€æ´? : 'â?æœªæ¿€æ´?}</td>
                        </tr>`;
                    });
                    
                    html += '</table>';
                    
                    // ç‰¹åˆ«æ˜¾ç¤ºVIPç­‰çº§2çš„è¯¦ç»†ä¿¡æ?
                    const vip2 = data.data.find(level => level.id === 2);
                    if (vip2) {
                        html += '<h4>ğŸ¯ VIPç­‰çº§2è¯¦ç»†ä¿¡æ¯:</h4>';
                        html += '<table>';
                        html += '<tr><th>å­—æ®µå?/th><th>å€?/th><th>ç±»å‹</th></tr>';
                        Object.keys(vip2).forEach(key => {
                            html += `<tr>
                                <td><strong>${key}</strong></td>
                                <td>${vip2[key]}</td>
                                <td>${typeof vip2[key]}</td>
                            </tr>`;
                        });
                        html += '</table>';
                    }
                    
                    addResult('success', 'âœ?APIæµ‹è¯•æˆåŠŸ', html);
                } else {
                    addResult('error', 'â?APIè¿”å›é”™è¯¯', `<p>é”™è¯¯ä¿¡æ¯: ${data.message}</p>`);
                }
            } catch (error) {
                addResult('error', 'â?è¯·æ±‚å¤±è´¥', `<p>é”™è¯¯è¯¦æƒ…: ${error.message}</p>`);
            }
        }
        
        async function testUpdate() {
            addResult('info', 'ğŸ”„ å¼€å§‹æµ‹è¯•æ›´æ–?, 'æ­£åœ¨æ›´æ–°VIPç­‰çº§2...');
            
            try {
                const updateData = {
                    name: "VIP1",
                    description: "è°ƒè¯•æµ‹è¯•æ›´æ–°",
                    stepTarget: 1500,
                    depositAmount: 15,
                    dailyReward: 2,
                    duration: 2,
                    maxChallenges: 5,  // æ”¹ä¸º5æ¬?
                    maxFailedDays: 2,
                    cancelDeductRatio: 0.15,
                    cancelRewardRatio: 0,
                    partialRefundRatio: 0.85,
                    color: "#FF6B6B",
                    isActive: true
                };
                
                addResult('info', 'ğŸ“¤ å‘é€æ›´æ–°æ•°æ?, '<pre>' + JSON.stringify(updateData, null, 2) + '</pre>');
                
                const response = await fetch('http://localhost:3000/api/admin/vip-levels/2', {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'Cache-Control': 'no-cache',
                        'Pragma': 'no-cache'
                    },
                    body: JSON.stringify(updateData)
                });
                
                const result = await response.json();
                
                if (result.success) {
                    addResult('success', 'âœ?æ›´æ–°æˆåŠŸ', `
                        <p>æ›´æ–°æ“ä½œæˆåŠŸå®Œæˆï¼?/p>
                        <p><strong>è¿”å›æ•°æ®:</strong></p>
                        <pre>${JSON.stringify(result, null, 2)}</pre>
                        <p>ç°åœ¨è¯·ç‚¹å‡?æµ‹è¯•APIæ•°æ®"æŸ¥çœ‹æ›´æ–°åçš„ç»“æœã€?/p>
                    `);
                } else {
                    addResult('error', 'â?æ›´æ–°å¤±è´¥', `<p>é”™è¯¯ä¿¡æ¯: ${result.message}</p>`);
                }
            } catch (error) {
                addResult('error', 'â?æ›´æ–°è¯·æ±‚å¤±è´¥', `<p>é”™è¯¯è¯¦æƒ…: ${error.message}</p>`);
            }
        }
        
        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æµ‹è¯•API
        window.onload = function() {
            setTimeout(testAPI, 1000);
        };
    </script>
</body>
</html>
