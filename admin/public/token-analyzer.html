<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ” Tokenè¯¦ç»†åˆ†æå™?/title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .analyzer-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        .status-success { background: #28a745; }
        .status-error { background: #dc3545; }
        .status-warning { background: #ffc107; }
        .status-info { background: #17a2b8; }
        
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background: #0056b3; }
        button.danger { background: #dc3545; }
        button.danger:hover { background: #c82333; }
        
        .token-details {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            padding: 15px;
            margin: 10px 0;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
        }
        
        .jwt-parts {
            display: flex;
            gap: 10px;
            margin: 10px 0;
        }
        
        .jwt-part {
            flex: 1;
            background: #e9ecef;
            padding: 10px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 11px;
            word-break: break-all;
        }
        
        .jwt-part.header {
            background: #d1ecf1;
        }
        
        .jwt-part.payload {
            background: #d4edda;
        }
        
        .jwt-part.signature {
            background: #f8d7da;
        }
        
        .time-info {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        
        .countdown {
            font-size: 18px;
            font-weight: bold;
            color: #856404;
        }
    </style>
</head>
<body>
    <h1>ğŸ” Tokenè¯¦ç»†åˆ†æå™?/h1>
    
    <div class="analyzer-section">
        <h2>1. å½“å‰TokençŠ¶æ€?/h2>
        <button onclick="analyzeCurrentToken()">åˆ†æå½“å‰Token</button>
        <button onclick="clearToken()" class="danger">æ¸…é™¤Token</button>
        <div id="tokenAnalysis"></div>
    </div>

    <div class="analyzer-section">
        <h2>2. å®æ—¶å€’è®¡æ—?/h2>
        <div id="countdownDisplay"></div>
    </div>

    <div class="analyzer-section">
        <h2>3. Tokenå†å²è®°å½•</h2>
        <button onclick="loadTokenHistory()">åŠ è½½å†å²è®°å½•</button>
        <div id="tokenHistory"></div>
    </div>

    <script>
        let countdownInterval = null;

        // åˆ†æå½“å‰Token
        function analyzeCurrentToken() {
            const output = document.getElementById('tokenAnalysis');
            const adminToken = localStorage.getItem('adminToken');
            
            if (!adminToken) {
                output.innerHTML = '<div class="status-indicator status-error"></span>æ²¡æœ‰æ‰¾åˆ°Token</div>';
                return;
            }

            let analysis = '<h3>Tokenè¯¦ç»†åˆ†æ:</h3>';
            
            try {
                // è§£æJWT Token
                const parts = adminToken.split('.');
                if (parts.length !== 3) {
                    analysis += '<div class="status-indicator status-error"></span>æ— æ•ˆçš„JWTæ ¼å¼</div>';
                    output.innerHTML = analysis;
                    return;
                }

                // æ˜¾ç¤ºJWTå„éƒ¨åˆ?
                analysis += '<div class="jwt-parts">';
                analysis += `<div class="jwt-part header"><strong>Header:</strong><br>${parts[0]}</div>`;
                analysis += `<div class="jwt-part payload"><strong>Payload:</strong><br>${parts[1]}</div>`;
                analysis += `<div class="jwt-part signature"><strong>Signature:</strong><br>${parts[2]}</div>`;
                analysis += '</div>';

                // è§£æHeader
                try {
                    const header = JSON.parse(atob(parts[0]));
                    analysis += '<div class="token-details">';
                    analysis += '<strong>Headerä¿¡æ¯:</strong><br>';
                    analysis += `ç®—æ³•: ${header.alg}<br>`;
                    analysis += `ç±»å‹: ${header.typ}<br>`;
                    analysis += '</div>';
                } catch (e) {
                    analysis += '<div class="status-indicator status-error"></span>Headerè§£æå¤±è´¥</div>';
                }

                // è§£æPayload
                try {
                    const payload = JSON.parse(atob(parts[1]));
                    analysis += '<div class="token-details">';
                    analysis += '<strong>Payloadä¿¡æ¯:</strong><br>';
                    analysis += `ç”¨æˆ·ID: ${payload.id}<br>`;
                    analysis += `ç”¨æˆ·å? ${payload.username}<br>`;
                    analysis += `è§’è‰²: ${payload.role}<br>`;
                    analysis += `ç­¾å‘è€? ${payload.iss}<br>`;
                    analysis += `å—ä¼—: ${payload.aud}<br>`;
                    analysis += `ç­¾å‘æ—¶é—´: ${new Date(payload.iat * 1000).toLocaleString()}<br>`;
                    analysis += `è¿‡æœŸæ—¶é—´: ${new Date(payload.exp * 1000).toLocaleString()}<br>`;
                    analysis += '</div>';

                    // æ—¶é—´åˆ†æ
                    const now = Math.floor(Date.now() / 1000);
                    const exp = payload.exp;
                    const iat = payload.iat;
                    const timeLeft = exp - now;
                    const totalDuration = exp - iat;

                    analysis += '<div class="time-info">';
                    analysis += '<strong>æ—¶é—´åˆ†æ:</strong><br>';
                    analysis += `å½“å‰æ—¶é—´æˆ? ${now} (${new Date(now * 1000).toLocaleString()})<br>`;
                    analysis += `ç­¾å‘æ—¶é—´æˆ? ${iat} (${new Date(iat * 1000).toLocaleString()})<br>`;
                    analysis += `è¿‡æœŸæ—¶é—´æˆ? ${exp} (${new Date(exp * 1000).toLocaleString()})<br>`;
                    analysis += `å‰©ä½™æ—¶é—´: ${timeLeft} ç§?(${Math.floor(timeLeft / 60)} åˆ†é’Ÿ)<br>`;
                    analysis += `æ€»æœ‰æ•ˆæœŸ: ${totalDuration} ç§?(${Math.floor(totalDuration / 3600)} å°æ—¶)<br>`;
                    
                    if (timeLeft > 0) {
                        analysis += '<div class="status-indicator status-success"></span>Tokenæœ‰æ•ˆ</div>';
                    } else {
                        analysis += '<div class="status-indicator status-error"></span>Tokenå·²è¿‡æœ?/div>';
                    }
                    analysis += '</div>';

                    // å¼€å§‹å€’è®¡æ—?
                    startCountdown(exp);

                } catch (e) {
                    analysis += '<div class="status-indicator status-error"></span>Payloadè§£æå¤±è´¥: ' + e.message + '</div>';
                }

            } catch (error) {
                analysis += '<div class="status-indicator status-error"></span>Tokenåˆ†æå¤±è´¥: ' + error.message + '</div>';
            }

            output.innerHTML = analysis;
        }

        // å¼€å§‹å€’è®¡æ—?
        function startCountdown(expTime) {
            if (countdownInterval) {
                clearInterval(countdownInterval);
            }

            countdownInterval = setInterval(() => {
                const now = Math.floor(Date.now() / 1000);
                const timeLeft = expTime - now;
                const output = document.getElementById('countdownDisplay');

                if (timeLeft > 0) {
                    const hours = Math.floor(timeLeft / 3600);
                    const minutes = Math.floor((timeLeft % 3600) / 60);
                    const seconds = timeLeft % 60;
                    
                    output.innerHTML = `
                        <div class="countdown">
                            <div class="status-indicator status-success"></span>Tokenå‰©ä½™æ—¶é—´: ${hours}å°æ—¶ ${minutes}åˆ†é’Ÿ ${seconds}ç§?
                        </div>
                        <div>è¿‡æœŸæ—¶é—´: ${new Date(expTime * 1000).toLocaleString()}</div>
                    `;
                } else {
                    output.innerHTML = `
                        <div class="countdown">
                            <div class="status-indicator status-error"></span>Tokenå·²è¿‡æœ?
                        </div>
                        <div>è¿‡æœŸæ—¶é—´: ${new Date(expTime * 1000).toLocaleString()}</div>
                    `;
                    clearInterval(countdownInterval);
                }
            }, 1000);
        }

        // æ¸…é™¤Token
        function clearToken() {
            if (confirm('ç¡®å®šè¦æ¸…é™¤Tokenå—ï¼Ÿ')) {
                localStorage.removeItem('adminToken');
                localStorage.removeItem('adminUser');
                document.getElementById('tokenAnalysis').innerHTML = '<div class="status-indicator status-success"></span>Tokenå·²æ¸…é™?/div>';
                document.getElementById('countdownDisplay').innerHTML = '';
                if (countdownInterval) {
                    clearInterval(countdownInterval);
                }
            }
        }

        // åŠ è½½Tokenå†å²è®°å½•
        function loadTokenHistory() {
            const output = document.getElementById('tokenHistory');
            const adminToken = localStorage.getItem('adminToken');
            
            if (!adminToken) {
                output.innerHTML = '<div>æ²¡æœ‰Tokenå†å²è®°å½•</div>';
                return;
            }

            try {
                const parts = adminToken.split('.');
                const payload = JSON.parse(atob(parts[1]));
                
                let history = '<h3>Tokenå†å²ä¿¡æ¯:</h3>';
                history += '<div class="token-details">';
                history += `<strong>Tokenåˆ›å»ºæ—¶é—´:</strong> ${new Date(payload.iat * 1000).toLocaleString()}<br>`;
                history += `<strong>Tokenè¿‡æœŸæ—¶é—´:</strong> ${new Date(payload.exp * 1000).toLocaleString()}<br>`;
                history += `<strong>Tokenæœ‰æ•ˆæœ?</strong> ${Math.floor((payload.exp - payload.iat) / 3600)} å°æ—¶<br>`;
                history += `<strong>ç”¨æˆ·ä¿¡æ¯:</strong> ${payload.username} (ID: ${payload.id})<br>`;
                history += `<strong>ç”¨æˆ·è§’è‰²:</strong> ${payload.role}<br>`;
                history += '</div>';

                output.innerHTML = history;
            } catch (error) {
                output.innerHTML = '<div class="status-indicator status-error"></span>æ— æ³•è§£æTokenå†å²: ' + error.message + '</div>';
            }
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨åˆ†æ?
        window.addEventListener('load', () => {
            analyzeCurrentToken();
            loadTokenHistory();
        });
    </script>
</body>
</html>
