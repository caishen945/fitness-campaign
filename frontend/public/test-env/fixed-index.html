<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FitChallenge æœ¬åœ°æµ‹è¯•ç¯å¢ƒ (ä¿®å¤ç‰ˆ)</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="test-container">
        <!-- å¤´éƒ¨ -->
        <header class="test-header">
            <h1 class="test-title">ğŸš€ FitChallenge æœ¬åœ°æµ‹è¯•ç¯å¢ƒ (ä¿®å¤ç‰ˆ)</h1>
            <p class="test-subtitle">å®Œæ•´çš„æœ¬åœ°æµ‹è¯•ç¯å¢ƒï¼Œæ¨¡æ‹ŸçœŸå®æ‰‹æœºå’ŒTelegramç¯å¢ƒ</p>
        </header>

        <!-- æ§åˆ¶é¢æ¿ -->
        <div class="control-panel">
            <!-- è®¾å¤‡æ¨¡æ‹Ÿå™¨ -->
            <div class="control-section">
                <h3>ğŸ“± è®¾å¤‡æ¨¡æ‹Ÿå™¨</h3>
                <div class="device-controls">
                    <select id="deviceSelect" class="control-select">
                        <option value="desktop">æ¡Œé¢ç«¯ (1920x1080)</option>
                        <option value="tablet">å¹³æ¿ (768x1024)</option>
                        <option value="mobile">æ‰‹æœº (375x667)</option>
                        <option value="android">å®‰å“æ‰‹æœº (360x640)</option>
                        <option value="smallMobile">å°å±æ‰‹æœº (320x568)</option>
                        <option value="largeMobile">å¤§å±æ‰‹æœº (414x896)</option>
                    </select>
                    <button id="orientationBtn" class="control-btn">ğŸ”„ æ¨ªå±/ç«–å±</button>
                    <button id="customSizeBtn" class="control-btn">ğŸ“ è‡ªå®šä¹‰å°ºå¯¸</button>
                </div>
            </div>

            <!-- è¯­è¨€åˆ‡æ¢å™¨ -->
            <div class="control-section">
                <h3>ğŸŒ è¯­è¨€åˆ‡æ¢å™¨</h3>
                <div class="language-controls">
                    <select id="languageSelect" class="control-select">
                        <option value="en-US">ğŸ‡ºğŸ‡¸ English</option>
                        <option value="zh-CN">ğŸ‡¨ğŸ‡³ ç®€ä½“ä¸­æ–‡</option>
                        <option value="ja-JP">ğŸ‡¯ğŸ‡µ æ—¥æœ¬èª</option>
                        <option value="ko-KR">ğŸ‡°ğŸ‡· í•œêµ­ì–´</option>
                        <option value="ar-SA">ğŸ‡¸ğŸ‡¦ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</option>
                    </select>
                    <button id="testTranslationsBtn" class="control-btn">ğŸ§ª æµ‹è¯•ç¿»è¯‘</button>
                </div>
            </div>

            <!-- Telegramæ¨¡æ‹Ÿå™¨ -->
            <div class="control-section">
                <h3>ğŸ“± Telegramæ¨¡æ‹Ÿå™¨</h3>
                <div class="telegram-controls">
                    <button id="simulateAuthBtn" class="control-btn primary">ğŸ” æ¨¡æ‹Ÿæˆæƒ</button>
                    <button id="switchThemeBtn" class="control-btn">ğŸ¨ åˆ‡æ¢ä¸»é¢˜</button>
                    <button id="resetTelegramBtn" class="control-btn">ğŸ”„ é‡ç½®</button>
                </div>
            </div>

            <!-- APIæ¨¡æ‹Ÿå™¨ -->
            <div class="control-section">
                <h3>ğŸŒ APIæ¨¡æ‹Ÿå™¨</h3>
                <div class="api-controls">
                    <input type="number" id="apiDelayInput" class="control-input" placeholder="å»¶è¿Ÿ(ms)" value="500">
                    <button id="setDelayBtn" class="control-btn">â±ï¸ è®¾ç½®å»¶è¿Ÿ</button>
                    <button id="resetApiBtn" class="control-btn">ğŸ”„ é‡ç½®</button>
                </div>
            </div>
        </div>

        <!-- æµ‹è¯•åŒºåŸŸ -->
        <div class="test-area">
            <!-- è®¾å¤‡æ¡†æ¶ -->
            <div id="deviceFrame" class="device-frame">
                <div class="device-content">
                    <h2>ğŸ“± è®¾å¤‡å†…å®¹åŒºåŸŸ</h2>
                    <p>è¿™é‡Œå°†æ˜¾ç¤ºæ¨¡æ‹Ÿè®¾å¤‡çš„å†…å®¹</p>
                    
                    <!-- æµ‹è¯•æŒ‰é’® -->
                    <div class="test-buttons">
                        <button class="test-btn" data-i18n="common.loading">Loading...</button>
                        <button class="test-btn" data-i18n="common.success">Success</button>
                        <button class="test-btn" data-i18n="navigation.home">Home</button>
                        <button class="test-btn" data-i18n="user.username">Username</button>
                    </div>
                    
                    <!-- è¡¨å•æµ‹è¯• -->
                    <div class="form-test">
                        <h3>è¡¨å•æµ‹è¯•</h3>
                        <input type="text" placeholder="ç”¨æˆ·å" data-i18n-placeholder="user.username">
                        <input type="email" placeholder="é‚®ç®±" data-i18n-placeholder="user.email">
                        <input type="password" placeholder="å¯†ç " data-i18n-placeholder="user.password">
                    </div>
                </div>
            </div>
        </div>

        <!-- çŠ¶æ€ç›‘æ§ -->
        <div class="status-monitor">
            <h3>ğŸ“Š çŠ¶æ€ç›‘æ§</h3>
            <div class="status-grid">
                <div class="status-item">
                    <h4>è®¾å¤‡çŠ¶æ€</h4>
                    <div id="deviceStatus" class="status-content">åŠ è½½ä¸­...</div>
                </div>
                <div class="status-item">
                    <h4>è¯­è¨€çŠ¶æ€</h4>
                    <div id="languageStatus" class="status-content">åŠ è½½ä¸­...</div>
                </div>
                <div class="status-item">
                    <h4>TelegramçŠ¶æ€</h4>
                    <div id="telegramStatus" class="status-content">åŠ è½½ä¸­...</div>
                </div>
                <div class="status-item">
                    <h4>APIçŠ¶æ€</h4>
                    <div id="apiStatus" class="status-content">åŠ è½½ä¸­...</div>
                </div>
            </div>
        </div>

        <!-- åŠŸèƒ½æµ‹è¯• -->
        <div class="function-tests">
            <h3>ğŸ§ª åŠŸèƒ½æµ‹è¯•</h3>
            <div class="test-grid">
                <div class="test-card">
                    <h4>ğŸ“± TelegramåŠŸèƒ½æµ‹è¯•</h4>
                    <button id="testTelegramBtn" class="test-btn">æµ‹è¯•Telegram</button>
                    <button id="testWebAppBtn" class="test-btn">æµ‹è¯•WebApp</button>
                    <button id="testAuthBtn" class="test-btn">æµ‹è¯•è®¤è¯</button>
                </div>
                
                <div class="test-card">
                    <h4>ğŸŒ APIåŠŸèƒ½æµ‹è¯•</h4>
                    <button id="testLoginBtn" class="test-btn">æµ‹è¯•ç™»å½•</button>
                    <button id="testRegisterBtn" class="test-btn">æµ‹è¯•æ³¨å†Œ</button>
                    <button id="testProfileBtn" class="test-btn">æµ‹è¯•èµ„æ–™</button>
                </div>
                
                <div class="test-card">
                    <h4>ğŸŒ å¤šè¯­è¨€æµ‹è¯•</h4>
                    <button id="testLanguageBtn" class="test-btn">æµ‹è¯•è¯­è¨€</button>
                    <button id="testFormatBtn" class="test-btn">æµ‹è¯•æ ¼å¼</button>
                    <button id="testDirectionBtn" class="test-btn">æµ‹è¯•æ–¹å‘</button>
                </div>
                
                <div class="test-card">
                    <h4>ğŸ“ å“åº”å¼æµ‹è¯•</h4>
                    <button id="testResponsiveBtn" class="test-btn">æµ‹è¯•å“åº”å¼</button>
                    <button id="testOrientationBtn" class="test-btn">æµ‹è¯•æ–¹å‘</button>
                    <button id="testTouchBtn" class="test-btn">æµ‹è¯•è§¦æ‘¸</button>
                </div>
            </div>
        </div>

        <!-- æ§åˆ¶å°è¾“å‡º -->
        <div class="console-output">
            <div class="console-header">
                <h3>ğŸ“ æ§åˆ¶å°è¾“å‡º</h3>
                <button id="clearConsoleBtn" class="console-btn">æ¸…ç©º</button>
                <button id="exportConsoleBtn" class="console-btn">å¯¼å‡º</button>
            </div>
            <div id="consoleContent" class="console-content">
                <div class="console-line">ğŸš€ æµ‹è¯•ç¯å¢ƒåˆå§‹åŒ–ä¸­...</div>
            </div>
        </div>
    </div>

    <!-- è‡ªå®šä¹‰å°ºå¯¸å¼¹çª— -->
    <div id="customSizeModal" class="modal">
        <div class="modal-content">
            <h3>è‡ªå®šä¹‰è®¾å¤‡å°ºå¯¸</h3>
            <div class="modal-body">
                <div class="input-group">
                    <label for="customWidth">å®½åº¦ (px):</label>
                    <input type="number" id="customWidth" min="200" max="3000" value="375">
                </div>
                <div class="input-group">
                    <label for="customHeight">é«˜åº¦ (px):</label>
                    <input type="number" id="customHeight" min="200" max="3000" value="667">
                </div>
            </div>
            <div class="modal-footer">
                <button id="applyCustomSizeBtn" class="btn primary">åº”ç”¨</button>
                <button id="cancelCustomSizeBtn" class="btn">å–æ¶ˆ</button>
            </div>
        </div>
    </div>

    <!-- è„šæœ¬åŠ è½½ -->
    <script src="telegram-mock.js"></script>
    <script src="api-mock.js"></script>
    <script src="device-simulator.js"></script>
    <script src="language-tester.js"></script>
    
    <!-- ä¿®å¤ç‰ˆä¸»é€»è¾‘ -->
    <script>
        /**
         * ä¿®å¤ç‰ˆæµ‹è¯•ç¯å¢ƒä¸»é€»è¾‘
         * è§£å†³æ¨¡å—åŠ è½½å’Œäº‹ä»¶ç»‘å®šé—®é¢˜
         */
        
        class FixedTestEnvironment {
            constructor() {
                this.consoleOutput = document.getElementById('consoleContent');
                this.deviceFrame = document.getElementById('deviceFrame');
                this.customSizeModal = document.getElementById('customSizeModal');
                this.isInitialized = false;
                
                this.init();
            }
            
            /**
             * åˆå§‹åŒ–æµ‹è¯•ç¯å¢ƒ
             */
            init() {
                this.log('ğŸš€ åˆå§‹åŒ–ä¿®å¤ç‰ˆæµ‹è¯•ç¯å¢ƒ...');
                
                // ç­‰å¾…æ‰€æœ‰æ¨¡å—åŠ è½½å®Œæˆ
                this.waitForModules().then(() => {
                    this.setupEventListeners();
                    this.updateStatus();
                    this.isInitialized = true;
                    this.log('âœ… ä¿®å¤ç‰ˆæµ‹è¯•ç¯å¢ƒåˆå§‹åŒ–å®Œæˆ');
                    
                    // åº”ç”¨å“åº”å¼æ ·å¼
                    if (window.deviceSimulator) {
                        window.deviceSimulator.applyResponsiveStyles();
                    }
                }).catch(error => {
                    this.log(`âŒ åˆå§‹åŒ–å¤±è´¥: ${error.message}`, 'error');
                });
            }
            
            /**
             * ç­‰å¾…æ‰€æœ‰æ¨¡å—åŠ è½½
             */
            async waitForModules() {
                const modules = ['telegramMock', 'apiMock', 'deviceSimulator', 'languageTester'];
                const maxWaitTime = 10000; // æœ€å¤§ç­‰å¾…10ç§’
                const startTime = Date.now();
                
                this.log('â³ ç­‰å¾…æ¨¡å—åŠ è½½...');
                
                for (const module of modules) {
                    while (!window[module]) {
                        if (Date.now() - startTime > maxWaitTime) {
                            throw new Error(`æ¨¡å— ${module} åŠ è½½è¶…æ—¶`);
                        }
                        await new Promise(resolve => setTimeout(resolve, 100));
                    }
                    this.log(`âœ… æ¨¡å— ${module} å·²åŠ è½½`);
                }
                
                this.log('âœ… æ‰€æœ‰æ¨¡å—å·²åŠ è½½å®Œæˆ');
            }
            
            /**
             * è®¾ç½®äº‹ä»¶ç›‘å¬å™¨
             */
            setupEventListeners() {
                this.log('ğŸ”§ è®¾ç½®äº‹ä»¶ç›‘å¬å™¨...');
                
                try {
                    // è®¾å¤‡æ¨¡æ‹Ÿå™¨æ§åˆ¶
                    this.setupDeviceControls();
                    
                    // è¯­è¨€åˆ‡æ¢å™¨æ§åˆ¶
                    this.setupLanguageControls();
                    
                    // Telegramæ¨¡æ‹Ÿå™¨æ§åˆ¶
                    this.setupTelegramControls();
                    
                    // APIæ¨¡æ‹Ÿå™¨æ§åˆ¶
                    this.setupApiControls();
                    
                    // åŠŸèƒ½æµ‹è¯•æ§åˆ¶
                    this.setupFunctionTests();
                    
                    // æ§åˆ¶å°æ§åˆ¶
                    this.setupConsoleControls();
                    
                    // æ¨¡æ€æ¡†æ§åˆ¶
                    this.setupModalControls();
                    
                    // ç›‘å¬è®¾å¤‡å˜åŒ–äº‹ä»¶
                    this.setupGlobalEventListeners();
                    
                    this.log('âœ… äº‹ä»¶ç›‘å¬å™¨è®¾ç½®å®Œæˆ');
                } catch (error) {
                    this.log(`âŒ è®¾ç½®äº‹ä»¶ç›‘å¬å™¨å¤±è´¥: ${error.message}`, 'error');
                }
            }
            
            /**
             * è®¾ç½®è®¾å¤‡æ§åˆ¶
             */
            setupDeviceControls() {
                const deviceSelect = document.getElementById('deviceSelect');
                const orientationBtn = document.getElementById('orientationBtn');
                const customSizeBtn = document.getElementById('customSizeBtn');
                
                if (deviceSelect) {
                    deviceSelect.addEventListener('change', (e) => {
                        const deviceType = e.target.value;
                        if (window.deviceSimulator) {
                            window.deviceSimulator.switchDevice(deviceType);
                            this.updateDeviceFrame();
                            this.log(`ğŸ“± åˆ‡æ¢åˆ°è®¾å¤‡: ${deviceType}`);
                        }
                    });
                }
                
                if (orientationBtn) {
                    orientationBtn.addEventListener('click', () => {
                        if (window.deviceSimulator) {
                            const currentOrientation = window.deviceSimulator.currentOrientation;
                            const newOrientation = currentOrientation === 'portrait' ? 'landscape' : 'portrait';
                            window.deviceSimulator.switchOrientation(newOrientation);
                            this.updateDeviceFrame();
                            this.log(`ğŸ”„ åˆ‡æ¢åˆ°æ–¹å‘: ${newOrientation}`);
                        }
                    });
                }
                
                if (customSizeBtn) {
                    customSizeBtn.addEventListener('click', () => {
                        this.showCustomSizeModal();
                    });
                }
            }
            
            /**
             * è®¾ç½®è¯­è¨€æ§åˆ¶
             */
            setupLanguageControls() {
                const languageSelect = document.getElementById('languageSelect');
                const testTranslationsBtn = document.getElementById('testTranslationsBtn');
                
                if (languageSelect) {
                    languageSelect.addEventListener('change', (e) => {
                        const languageCode = e.target.value;
                        if (window.languageTester) {
                            window.languageTester.switchLanguage(languageCode);
                            this.log(`ğŸŒ åˆ‡æ¢åˆ°è¯­è¨€: ${languageCode}`);
                        }
                    });
                }
                
                if (testTranslationsBtn) {
                    testTranslationsBtn.addEventListener('click', () => {
                        if (window.languageTester) {
                            const results = window.languageTester.testTranslations();
                            this.log('ğŸ§ª ç¿»è¯‘æµ‹è¯•å®Œæˆï¼Œç»“æœå·²è¾“å‡ºåˆ°æ§åˆ¶å°');
                            console.log('ç¿»è¯‘æµ‹è¯•ç»“æœ:', results);
                        }
                    });
                }
            }
            
            /**
             * è®¾ç½®Telegramæ§åˆ¶
             */
            setupTelegramControls() {
                const simulateAuthBtn = document.getElementById('simulateAuthBtn');
                const switchThemeBtn = document.getElementById('switchThemeBtn');
                const resetTelegramBtn = document.getElementById('resetTelegramBtn');
                
                if (simulateAuthBtn) {
                    simulateAuthBtn.addEventListener('click', () => {
                        if (window.telegramMock) {
                            window.telegramMock.simulateAuth();
                            this.log('ğŸ” æ¨¡æ‹ŸTelegramç”¨æˆ·æˆæƒ');
                        }
                    });
                }
                
                if (switchThemeBtn) {
                    switchThemeBtn.addEventListener('click', () => {
                        if (window.telegramMock) {
                            const currentTheme = window.telegramMock.colorScheme;
                            const newTheme = currentTheme === 'light' ? 'dark' : 'light';
                            window.telegramMock.switchTheme(newTheme);
                            this.log(`ğŸ¨ åˆ‡æ¢åˆ°ä¸»é¢˜: ${newTheme}`);
                        }
                    });
                }
                
                if (resetTelegramBtn) {
                    resetTelegramBtn.addEventListener('click', () => {
                        if (window.telegramMock) {
                            window.telegramMock.reset();
                            this.log('ğŸ”„ Telegramæ¨¡æ‹Ÿå™¨å·²é‡ç½®');
                        }
                    });
                }
            }
            
            /**
             * è®¾ç½®APIæ§åˆ¶
             */
            setupApiControls() {
                const setDelayBtn = document.getElementById('setDelayBtn');
                const resetApiBtn = document.getElementById('resetApiBtn');
                
                if (setDelayBtn) {
                    setDelayBtn.addEventListener('click', () => {
                        const delay = parseInt(document.getElementById('apiDelayInput').value);
                        if (delay >= 0 && window.apiMock) {
                            window.apiMock.setDelay(delay);
                            this.log(`â±ï¸ APIå»¶è¿Ÿè®¾ç½®ä¸º: ${delay}ms`);
                        }
                    });
                }
                
                if (resetApiBtn) {
                    resetApiBtn.addEventListener('click', () => {
                        if (window.apiMock) {
                            window.apiMock.reset();
                            this.log('ğŸ”„ APIæ¨¡æ‹Ÿå™¨å·²é‡ç½®');
                        }
                    });
                }
            }
            
            /**
             * è®¾ç½®åŠŸèƒ½æµ‹è¯•
             */
            setupFunctionTests() {
                this.log('ğŸ§ª è®¾ç½®åŠŸèƒ½æµ‹è¯•...');
                
                // TelegramåŠŸèƒ½æµ‹è¯•
                this.setupTestButton('testTelegramBtn', () => this.testTelegramFunctions());
                this.setupTestButton('testWebAppBtn', () => this.testWebAppFunctions());
                this.setupTestButton('testAuthBtn', () => this.testAuthFunctions());
                
                // APIåŠŸèƒ½æµ‹è¯•
                this.setupTestButton('testLoginBtn', () => this.testApiLogin());
                this.setupTestButton('testRegisterBtn', () => this.testApiRegister());
                this.setupTestButton('testProfileBtn', () => this.testApiProfile());
                
                // å¤šè¯­è¨€æµ‹è¯•
                this.setupTestButton('testLanguageBtn', () => this.testLanguageFunctions());
                this.setupTestButton('testFormatBtn', () => this.testFormatFunctions());
                this.setupTestButton('testDirectionBtn', () => this.testDirectionFunctions());
                
                // å“åº”å¼æµ‹è¯•
                this.setupTestButton('testResponsiveBtn', () => this.testResponsiveFunctions());
                this.setupTestButton('testOrientationBtn', () => this.testOrientationFunctions());
                this.setupTestButton('testTouchBtn', () => this.testTouchFunctions());
            }
            
            /**
             * è®¾ç½®æµ‹è¯•æŒ‰é’®
             */
            setupTestButton(buttonId, testFunction) {
                const button = document.getElementById(buttonId);
                if (button) {
                    button.addEventListener('click', () => {
                        if (this.isInitialized) {
                            testFunction.call(this);
                        } else {
                            this.log('âš ï¸ æµ‹è¯•ç¯å¢ƒå°šæœªåˆå§‹åŒ–å®Œæˆï¼Œè¯·ç¨å€™...', 'warning');
                        }
                    });
                    this.log(`âœ… æµ‹è¯•æŒ‰é’® ${buttonId} å·²è®¾ç½®`);
                } else {
                    this.log(`âŒ æœªæ‰¾åˆ°æµ‹è¯•æŒ‰é’®: ${buttonId}`, 'error');
                }
            }
            
            /**
             * è®¾ç½®æ§åˆ¶å°æ§åˆ¶
             */
            setupConsoleControls() {
                const clearConsoleBtn = document.getElementById('clearConsoleBtn');
                const exportConsoleBtn = document.getElementById('exportConsoleBtn');
                
                if (clearConsoleBtn) {
                    clearConsoleBtn.addEventListener('click', () => {
                        this.clearConsole();
                    });
                }
                
                if (exportConsoleBtn) {
                    exportConsoleBtn.addEventListener('click', () => {
                        this.exportConsole();
                    });
                }
            }
            
            /**
             * è®¾ç½®æ¨¡æ€æ¡†æ§åˆ¶
             */
            setupModalControls() {
                const applyCustomSizeBtn = document.getElementById('applyCustomSizeBtn');
                const cancelCustomSizeBtn = document.getElementById('cancelCustomSizeBtn');
                
                if (applyCustomSizeBtn) {
                    applyCustomSizeBtn.addEventListener('click', () => {
                        this.applyCustomSize();
                    });
                }
                
                if (cancelCustomSizeBtn) {
                    cancelCustomSizeBtn.addEventListener('click', () => {
                        this.hideCustomSizeModal();
                    });
                }
            }
            
            /**
             * è®¾ç½®å…¨å±€äº‹ä»¶ç›‘å¬å™¨
             */
            setupGlobalEventListeners() {
                // ç›‘å¬è®¾å¤‡å˜åŒ–
                window.addEventListener('device-changed', (e) => {
                    this.updateDeviceFrame();
                    this.updateStatus();
                    this.log(`ğŸ“± è®¾å¤‡å·²åˆ‡æ¢åˆ°: ${e.detail.deviceInfo.name}`);
                });
                
                // ç›‘å¬æ–¹å‘å˜åŒ–
                window.addEventListener('orientation-changed', (e) => {
                    this.updateDeviceFrame();
                    this.log(`ğŸ”„ æ–¹å‘å·²åˆ‡æ¢åˆ°: ${e.detail.orientation}`);
                });
                
                // ç›‘å¬è¯­è¨€å˜åŒ–
                window.addEventListener('language-changed', (e) => {
                    this.updateStatus();
                    this.log(`ğŸŒ è¯­è¨€å·²åˆ‡æ¢åˆ°: ${e.detail.languageInfo.name}`);
                });
            }
            
            /**
             * æ›´æ–°è®¾å¤‡æ¡†æ¶
             */
            updateDeviceFrame() {
                if (!window.deviceSimulator || !this.deviceFrame) return;
                
                try {
                    const deviceInfo = window.deviceSimulator.getCurrentDeviceInfo();
                    const frame = this.deviceFrame;
                    
                    // æ›´æ–°æ¡†æ¶ç±»å
                    frame.className = `device-frame ${deviceInfo.platform}`;
                    
                    // æ›´æ–°å°ºå¯¸
                    frame.style.width = `${deviceInfo.actualWidth}px`;
                    frame.style.height = `${deviceInfo.actualHeight}px`;
                    
                    // æ›´æ–°å†…å®¹
                    const content = frame.querySelector('.device-content');
                    if (content) {
                        content.style.width = `${deviceInfo.actualWidth - 60}px`;
                        content.style.height = `${deviceInfo.actualHeight - 60}px`;
                    }
                } catch (error) {
                    this.log(`âŒ æ›´æ–°è®¾å¤‡æ¡†æ¶å¤±è´¥: ${error.message}`, 'error');
                }
            }
            
            /**
             * æ›´æ–°çŠ¶æ€æ˜¾ç¤º
             */
            updateStatus() {
                try {
                    // è®¾å¤‡çŠ¶æ€
                    if (window.deviceSimulator) {
                        const deviceStatus = document.getElementById('deviceStatus');
                        if (deviceStatus) {
                            const status = window.deviceSimulator.getStatus();
                            deviceStatus.innerHTML = `
                                <div><strong>å½“å‰è®¾å¤‡:</strong> ${status.deviceInfo.name}</div>
                                <div><strong>å°ºå¯¸:</strong> ${status.deviceInfo.actualWidth}x${status.deviceInfo.actualHeight}</div>
                                <div><strong>æ–¹å‘:</strong> ${status.orientation}</div>
                                <div><strong>å¹³å°:</strong> ${status.deviceInfo.platform}</div>
                            `;
                        }
                    }
                    
                    // è¯­è¨€çŠ¶æ€
                    if (window.languageTester) {
                        const languageStatus = document.getElementById('languageStatus');
                        if (languageStatus) {
                            const status = window.languageTester.getStatus();
                            languageStatus.innerHTML = `
                                <div><strong>å½“å‰è¯­è¨€:</strong> ${status.currentLanguageInfo.name}</div>
                                <div><strong>ä»£ç :</strong> ${status.currentLanguageInfo.code}</div>
                                <div><strong>æ–¹å‘:</strong> ${status.currentLanguageInfo.direction}</div>
                                <div><strong>HTML:</strong> ${status.htmlLang}</div>
                            `;
                        }
                    }
                    
                    // TelegramçŠ¶æ€
                    if (window.telegramMock) {
                        const telegramStatus = document.getElementById('telegramStatus');
                        if (telegramStatus) {
                            const status = window.telegramMock.getStatus();
                            telegramStatus.innerHTML = `
                                <div><strong>å¹³å°:</strong> ${status.platform}</div>
                                <div><strong>ä¸»é¢˜:</strong> ${status.colorScheme}</div>
                                <div><strong>è§†å£é«˜åº¦:</strong> ${status.viewportHeight}</div>
                                <div><strong>ç”¨æˆ·:</strong> ${status.currentUser?.username || 'æ— '}</div>
                            `;
                        }
                    }
                    
                    // APIçŠ¶æ€
                    if (window.apiMock) {
                        const apiStatus = document.getElementById('apiStatus');
                        if (apiStatus) {
                            const status = window.apiMock.getStatus();
                            apiStatus.innerHTML = `
                                <div><strong>å»¶è¿Ÿ:</strong> ${status.delay}ms</div>
                                <div><strong>ç”¨æˆ·æ•°:</strong> ${status.userCount}</div>
                                <div><strong>Tokenæ•°:</strong> ${status.tokenCount}</div>
                                <div><strong>åŸºç¡€URL:</strong> ${status.baseUrl}</div>
                            `;
                        }
                    }
                } catch (error) {
                    this.log(`âŒ æ›´æ–°çŠ¶æ€å¤±è´¥: ${error.message}`, 'error');
                }
            }
            
            /**
             * æ˜¾ç¤ºè‡ªå®šä¹‰å°ºå¯¸æ¨¡æ€æ¡†
             */
            showCustomSizeModal() {
                if (this.customSizeModal) {
                    this.customSizeModal.classList.add('show');
                }
            }
            
            /**
             * éšè—è‡ªå®šä¹‰å°ºå¯¸æ¨¡æ€æ¡†
             */
            hideCustomSizeModal() {
                if (this.customSizeModal) {
                    this.customSizeModal.classList.remove('show');
                }
            }
            
            /**
             * åº”ç”¨è‡ªå®šä¹‰å°ºå¯¸
             */
            applyCustomSize() {
                const width = parseInt(document.getElementById('customWidth').value);
                const height = parseInt(document.getElementById('customHeight').value);
                
                if (width >= 200 && height >= 200 && width <= 3000 && height <= 3000) {
                    if (window.deviceSimulator) {
                        window.deviceSimulator.setCustomDimensions(width, height);
                        this.hideCustomSizeModal();
                        this.log(`ğŸ“ è‡ªå®šä¹‰å°ºå¯¸å·²è®¾ç½®: ${width}x${height}`);
                    }
                } else {
                    alert('è¯·è¾“å…¥æœ‰æ•ˆçš„å°ºå¯¸ (200-3000px)');
                }
            }
            
            /**
             * æµ‹è¯•TelegramåŠŸèƒ½
             */
            testTelegramFunctions() {
                this.log('ğŸ§ª å¼€å§‹æµ‹è¯•TelegramåŠŸèƒ½...');
                
                try {
                    // æµ‹è¯•WebAppå¯¹è±¡
                    if (window.Telegram && window.Telegram.WebApp) {
                        this.log('âœ… Telegram WebAppå¯¹è±¡å­˜åœ¨');
                        
                        // æµ‹è¯•åŸºæœ¬å±æ€§
                        const webApp = window.Telegram.WebApp;
                        this.log(`ğŸ“± å¹³å°: ${webApp.platform}`);
                        this.log(`ğŸ“± ç‰ˆæœ¬: ${webApp.version}`);
                        this.log(`ğŸ“± ä¸»é¢˜: ${webApp.colorScheme}`);
                        
                        // æµ‹è¯•æ–¹æ³•
                        if (webApp.ready) {
                            webApp.ready().then(() => {
                                this.log('âœ… WebApp.ready() æˆåŠŸ');
                            }).catch(error => {
                                this.log(`âŒ WebApp.ready() å¤±è´¥: ${error.message}`, 'error');
                            });
                        }
                        
                        if (webApp.expand) {
                            webApp.expand().then(() => {
                                this.log('âœ… WebApp.expand() æˆåŠŸ');
                            }).catch(error => {
                                this.log(`âŒ WebApp.expand() å¤±è´¥: ${error.message}`, 'error');
                            });
                        }
                        
                    } else {
                        this.log('âŒ Telegram WebAppå¯¹è±¡ä¸å­˜åœ¨');
                    }
                    
                    // æµ‹è¯•ç”¨æˆ·ä¿¡æ¯
                    if (window.telegramMock) {
                        const user = window.telegramMock.currentUser;
                        this.log(`ğŸ‘¤ å½“å‰ç”¨æˆ·: ${user.username} (${user.first_name} ${user.last_name})`);
                    }
                    
                } catch (error) {
                    this.log(`âŒ TelegramåŠŸèƒ½æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
                }
            }
            
            /**
             * æµ‹è¯•WebAppåŠŸèƒ½
             */
            testWebAppFunctions() {
                this.log('ğŸ§ª å¼€å§‹æµ‹è¯•WebAppåŠŸèƒ½...');
                
                try {
                    const webApp = window.Telegram?.WebApp;
                    if (!webApp) {
                        this.log('âŒ WebAppä¸å¯ç”¨');
                        return;
                    }
                    
                    // æµ‹è¯•æŒ‰é’®åŠŸèƒ½
                    const mainButton = webApp.MainButton;
                    if (mainButton) {
                        mainButton.setText('æµ‹è¯•æŒ‰é’®');
                        mainButton.show();
                        this.log('âœ… ä¸»æŒ‰é’®æ˜¾ç¤ºæˆåŠŸ');
                        
                        setTimeout(() => {
                            mainButton.hide();
                            this.log('âœ… ä¸»æŒ‰é’®éšè—æˆåŠŸ');
                        }, 2000);
                    }
                    
                    // æµ‹è¯•è§¦è§‰åé¦ˆ
                    const haptic = webApp.HapticFeedback;
                    if (haptic) {
                        haptic.impactOccurred();
                        this.log('âœ… è§¦è§‰åé¦ˆæµ‹è¯•æˆåŠŸ');
                    }
                    
                } catch (error) {
                    this.log(`âŒ WebAppåŠŸèƒ½æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
                }
            }
            
            /**
             * æµ‹è¯•è®¤è¯åŠŸèƒ½
             */
            testAuthFunctions() {
                this.log('ğŸ§ª å¼€å§‹æµ‹è¯•è®¤è¯åŠŸèƒ½...');
                
                try {
                    // æ¨¡æ‹Ÿè®¤è¯
                    if (window.telegramMock) {
                        window.telegramMock.simulateAuth();
                        this.log('âœ… è®¤è¯æ¨¡æ‹ŸæˆåŠŸ');
                        
                        // æ£€æŸ¥è®¤è¯çŠ¶æ€
                        setTimeout(() => {
                            const user = window.telegramMock.currentUser;
                            if (user) {
                                this.log(`âœ… ç”¨æˆ·è®¤è¯æˆåŠŸ: ${user.username}`);
                            } else {
                                this.log('âŒ ç”¨æˆ·è®¤è¯å¤±è´¥');
                            }
                        }, 1000);
                    }
                    
                } catch (error) {
                    this.log(`âŒ è®¤è¯åŠŸèƒ½æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
                }
            }
            
            /**
             * æµ‹è¯•APIç™»å½•
             */
            async testApiLogin() {
                this.log('ğŸ§ª å¼€å§‹æµ‹è¯•APIç™»å½•...');
                
                try {
                    if (window.apiMock) {
                        const response = await window.apiMock.request('/api/auth/login', 'POST', {
                            email: 'test1@example.com',
                            password: 'password123'
                        });
                        
                        if (response.success) {
                            this.log('âœ… APIç™»å½•æµ‹è¯•æˆåŠŸ');
                            this.log(`ğŸ‘¤ ç”¨æˆ·: ${response.user.username}`);
                            this.log(`ğŸ”‘ Token: ${response.token.substring(0, 20)}...`);
                        } else {
                            this.log('âŒ APIç™»å½•æµ‹è¯•å¤±è´¥');
                        }
                    } else {
                        this.log('âŒ APIæ¨¡æ‹Ÿå™¨ä¸å¯ç”¨');
                    }
                    
                } catch (error) {
                    this.log(`âŒ APIç™»å½•æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
                }
            }
            
            /**
             * æµ‹è¯•APIæ³¨å†Œ
             */
            async testApiRegister() {
                this.log('ğŸ§ª å¼€å§‹æµ‹è¯•APIæ³¨å†Œ...');
                
                try {
                    if (window.apiMock) {
                        const response = await window.apiMock.request('/api/auth/register', 'POST', {
                            username: `testuser_${Date.now()}`,
                            email: `test_${Date.now()}@example.com`,
                            password: 'password123'
                        });
                        
                        if (response.success) {
                            this.log('âœ… APIæ³¨å†Œæµ‹è¯•æˆåŠŸ');
                            this.log(`ğŸ‘¤ æ–°ç”¨æˆ·: ${response.user.username}`);
                        } else {
                            this.log('âŒ APIæ³¨å†Œæµ‹è¯•å¤±è´¥');
                        }
                    } else {
                        this.log('âŒ APIæ¨¡æ‹Ÿå™¨ä¸å¯ç”¨');
                    }
                    
                } catch (error) {
                    this.log(`âŒ APIæ³¨å†Œæµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
                }
            }
            
            /**
             * æµ‹è¯•APIèµ„æ–™
             */
            async testApiProfile() {
                this.log('ğŸ§ª å¼€å§‹æµ‹è¯•APIèµ„æ–™...');
                
                try {
                    if (window.apiMock) {
                        // å…ˆç™»å½•è·å–token
                        const loginResponse = await window.apiMock.request('/api/auth/login', 'POST', {
                            email: 'test1@example.com',
                            password: 'password123'
                        });
                        
                        if (loginResponse.success) {
                            const token = loginResponse.token;
                            
                            // è·å–èµ„æ–™
                            const profileResponse = await window.apiMock.request('/api/users/profile', 'GET', { token });
                            
                            if (profileResponse.success) {
                                this.log('âœ… APIèµ„æ–™è·å–æˆåŠŸ');
                                this.log(`ğŸ‘¤ ç”¨æˆ·èµ„æ–™: ${profileResponse.user.username}`);
                            } else {
                                this.log('âŒ APIèµ„æ–™è·å–å¤±è´¥');
                            }
                        } else {
                            this.log('âŒ ç™»å½•å¤±è´¥ï¼Œæ— æ³•æµ‹è¯•èµ„æ–™åŠŸèƒ½');
                        }
                    } else {
                        this.log('âŒ APIæ¨¡æ‹Ÿå™¨ä¸å¯ç”¨');
                    }
                    
                } catch (error) {
                    this.log(`âŒ APIèµ„æ–™æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
                }
            }
            
            /**
             * æµ‹è¯•è¯­è¨€åŠŸèƒ½
             */
            testLanguageFunctions() {
                this.log('ğŸ§ª å¼€å§‹æµ‹è¯•è¯­è¨€åŠŸèƒ½...');
                
                try {
                    if (window.languageTester) {
                        const results = window.languageTester.testTranslations();
                        this.log('âœ… è¯­è¨€åŠŸèƒ½æµ‹è¯•å®Œæˆ');
                        
                        // æ˜¾ç¤ºæµ‹è¯•ç»“æœ
                        Object.entries(results).forEach(([lang, translations]) => {
                            this.log(`ğŸŒ ${lang}: ${Object.values(translations).filter(t => t !== 'MISSING').length}/${Object.keys(translations).length} ç¿»è¯‘å¯ç”¨`);
                        });
                    } else {
                        this.log('âŒ è¯­è¨€æµ‹è¯•å™¨ä¸å¯ç”¨');
                    }
                    
                } catch (error) {
                    this.log(`âŒ è¯­è¨€åŠŸèƒ½æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
                }
            }
            
            /**
             * æµ‹è¯•æ ¼å¼åŠŸèƒ½
             */
            testFormatFunctions() {
                this.log('ğŸ§ª å¼€å§‹æµ‹è¯•æ ¼å¼åŠŸèƒ½...');
                
                try {
                    if (window.languageTester) {
                        const now = new Date();
                        const number = 1234567.89;
                        
                        // æµ‹è¯•æ—¥æœŸæ ¼å¼
                        const dateFormats = ['en-US', 'zh-CN', 'ja-JP'];
                        dateFormats.forEach(lang => {
                            window.languageTester.switchLanguage(lang);
                            const formattedDate = window.languageTester.formatDate(now);
                            this.log(`ğŸ“… ${lang}: ${formattedDate}`);
                        });
                        
                        // æµ‹è¯•æ•°å­—æ ¼å¼
                        const formattedNumber = window.languageTester.formatNumber(number, { showThousands: true });
                        this.log(`ğŸ”¢ æ•°å­—æ ¼å¼: ${formattedNumber}`);
                        
                        // æ¢å¤å½“å‰è¯­è¨€
                        const currentLang = window.languageTester.getCurrentLanguageInfo().code;
                        window.languageTester.switchLanguage(currentLang);
                        
                        this.log('âœ… æ ¼å¼åŠŸèƒ½æµ‹è¯•å®Œæˆ');
                    } else {
                        this.log('âŒ è¯­è¨€æµ‹è¯•å™¨ä¸å¯ç”¨');
                    }
                    
                } catch (error) {
                    this.log(`âŒ æ ¼å¼åŠŸèƒ½æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
                }
            }
            
            /**
             * æµ‹è¯•æ–¹å‘åŠŸèƒ½
             */
            testDirectionFunctions() {
                this.log('ğŸ§ª å¼€å§‹æµ‹è¯•æ–¹å‘åŠŸèƒ½...');
                
                try {
                    if (window.languageTester) {
                        const languages = window.languageTester.getSupportedLanguages();
                        
                        languages.forEach(lang => {
                            const direction = lang.direction;
                            const testText = lang.nativeName;
                            const detectedDirection = window.languageTester.detectTextDirection(testText);
                            
                            this.log(`ğŸŒ ${lang.code}: ${direction} (æ£€æµ‹: ${detectedDirection})`);
                        });
                        
                        this.log('âœ… æ–¹å‘åŠŸèƒ½æµ‹è¯•å®Œæˆ');
                    } else {
                        this.log('âŒ è¯­è¨€æµ‹è¯•å™¨ä¸å¯ç”¨');
                    }
                    
                } catch (error) {
                    this.log(`âŒ æ–¹å‘åŠŸèƒ½æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
                }
            }
            
            /**
             * æµ‹è¯•å“åº”å¼åŠŸèƒ½
             */
            testResponsiveFunctions() {
                this.log('ğŸ§ª å¼€å§‹æµ‹è¯•å“åº”å¼åŠŸèƒ½...');
                
                try {
                    if (window.deviceSimulator) {
                        const devices = window.deviceSimulator.getAvailableDevices();
                        
                        devices.forEach(device => {
                            this.log(`ğŸ“± ${device.name}: ${device.width}x${device.height} (${device.platform})`);
                        });
                        
                        this.log('âœ… å“åº”å¼åŠŸèƒ½æµ‹è¯•å®Œæˆ');
                    } else {
                        this.log('âŒ è®¾å¤‡æ¨¡æ‹Ÿå™¨ä¸å¯ç”¨');
                    }
                    
                } catch (error) {
                    this.log(`âŒ å“åº”å¼åŠŸèƒ½æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
                }
            }
            
            /**
             * æµ‹è¯•æ–¹å‘åŠŸèƒ½
             */
            testOrientationFunctions() {
                this.log('ğŸ§ª å¼€å§‹æµ‹è¯•æ–¹å‘åŠŸèƒ½...');
                
                try {
                    if (window.deviceSimulator) {
                        const currentOrientation = window.deviceSimulator.currentOrientation;
                        this.log(`ğŸ“ å½“å‰æ–¹å‘: ${currentOrientation}`);
                        
                        // æµ‹è¯•æ–¹å‘åˆ‡æ¢
                        const newOrientation = currentOrientation === 'portrait' ? 'landscape' : 'portrait';
                        window.deviceSimulator.switchOrientation(newOrientation);
                        
                        setTimeout(() => {
                            this.log(`ğŸ“ æ–¹å‘åˆ‡æ¢å®Œæˆ: ${newOrientation}`);
                            // æ¢å¤åŸæ–¹å‘
                            window.deviceSimulator.switchOrientation(currentOrientation);
                        }, 1000);
                        
                    } else {
                        this.log('âŒ è®¾å¤‡æ¨¡æ‹Ÿå™¨ä¸å¯ç”¨');
                    }
                    
                } catch (error) {
                    this.log(`âŒ æ–¹å‘åŠŸèƒ½æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
                }
            }
            
            /**
             * æµ‹è¯•è§¦æ‘¸åŠŸèƒ½
             */
            testTouchFunctions() {
                this.log('ğŸ§ª å¼€å§‹æµ‹è¯•è§¦æ‘¸åŠŸèƒ½...');
                
                try {
                    if (window.deviceSimulator) {
                        const deviceInfo = window.deviceSimulator.getCurrentDeviceInfo();
                        
                        this.log(`ğŸ“± è®¾å¤‡ç±»å‹: ${deviceInfo.platform}`);
                        this.log(`ğŸ“± æ˜¯å¦ç§»åŠ¨è®¾å¤‡: ${deviceInfo.isMobile}`);
                        this.log(`ğŸ“± è§¦æ‘¸ç‚¹æ•°é‡: ${navigator.maxTouchPoints || 0}`);
                        
                        if (deviceInfo.isMobile) {
                            this.log('âœ… è§¦æ‘¸åŠŸèƒ½å¯ç”¨');
                        } else {
                            this.log('â„¹ï¸ è§¦æ‘¸åŠŸèƒ½ä¸å¯ç”¨ï¼ˆéç§»åŠ¨è®¾å¤‡ï¼‰');
                        }
                        
                    } else {
                        this.log('âŒ è®¾å¤‡æ¨¡æ‹Ÿå™¨ä¸å¯ç”¨');
                    }
                    
                } catch (error) {
                    this.log(`âŒ è§¦æ‘¸åŠŸèƒ½æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
                }
            }
            
            /**
             * æ·»åŠ æ—¥å¿—
             */
            log(message, type = 'info') {
                if (!this.consoleOutput) return;
                
                const timestamp = new Date().toLocaleTimeString();
                const line = document.createElement('div');
                line.className = `console-line ${type}`;
                line.textContent = `[${timestamp}] ${message}`;
                
                this.consoleOutput.appendChild(line);
                this.consoleOutput.scrollTop = this.consoleOutput.scrollHeight;
                
                // åŒæ—¶è¾“å‡ºåˆ°æ§åˆ¶å°
                console.log(message);
            }
            
            /**
             * æ¸…ç©ºæ§åˆ¶å°
             */
            clearConsole() {
                if (this.consoleOutput) {
                    this.consoleOutput.innerHTML = '';
                    this.log('ğŸ§¹ æ§åˆ¶å°å·²æ¸…ç©º');
                }
            }
            
            /**
             * å¯¼å‡ºæ§åˆ¶å°
             */
            exportConsole() {
                if (!this.consoleOutput) return;
                
                const content = this.consoleOutput.textContent;
                const blob = new Blob([content], { type: 'text/plain' });
                const url = URL.createObjectURL(blob);
                
                const a = document.createElement('a');
                a.href = url;
                a.download = `test-console-${new Date().toISOString().slice(0, 19).replace(/:/g, '-')}.txt`;
                a.click();
                
                URL.revokeObjectURL(url);
                this.log('ğŸ“ æ§åˆ¶å°å·²å¯¼å‡º');
            }
        }
        
        // ç­‰å¾…DOMåŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            console.log('ğŸš€ å¼€å§‹åˆå§‹åŒ–ä¿®å¤ç‰ˆæµ‹è¯•ç¯å¢ƒ...');
            window.fixedTestEnvironment = new FixedTestEnvironment();
        });
        
        // å…¨å±€æµ‹è¯•å‡½æ•°
        window.testAll = function() {
            if (window.fixedTestEnvironment) {
                window.fixedTestEnvironment.log('ğŸ§ª å¼€å§‹æ‰§è¡Œæ‰€æœ‰æµ‹è¯•...');
                
                // æ‰§è¡Œæ‰€æœ‰æµ‹è¯•
                setTimeout(() => window.fixedTestEnvironment.testTelegramFunctions(), 100);
                setTimeout(() => window.fixedTestEnvironment.testWebAppFunctions(), 200);
                setTimeout(() => window.fixedTestEnvironment.testAuthFunctions(), 300);
                setTimeout(() => window.fixedTestEnvironment.testApiLogin(), 400);
                setTimeout(() => window.fixedTestEnvironment.testApiRegister(), 500);
                setTimeout(() => window.fixedTestEnvironment.testLanguageFunctions(), 600);
                setTimeout(() => window.fixedTestEnvironment.testResponsiveFunctions(), 700);
                
                window.fixedTestEnvironment.log('ğŸ¯ æ‰€æœ‰æµ‹è¯•å·²å¯åŠ¨ï¼Œè¯·æŸ¥çœ‹æ§åˆ¶å°è¾“å‡º');
            } else {
                console.error('ä¿®å¤ç‰ˆæµ‹è¯•ç¯å¢ƒæœªåˆå§‹åŒ–');
            }
        };
        
        console.log('ğŸ“± ä¿®å¤ç‰ˆæµ‹è¯•ç¯å¢ƒä¸»é€»è¾‘å·²åŠ è½½');
    </script>
</body>
</html>
