<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API集成测试页面</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .test-section {
            border: 1px solid #ddd;
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
        }
        .test-section h3 {
            margin-top: 0;
            color: #333;
        }
        .btn {
            background: #007bff;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        .btn:hover {
            background: #0056b3;
        }
        .btn:disabled {
            background: #6c757d;
            cursor: not-allowed;
        }
        .result {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            white-space: pre-wrap;
            font-family: monospace;
            max-height: 300px;
            overflow-y: auto;
        }
        .success {
            border-color: #28a745;
            background-color: #d4edda;
        }
        .error {
            border-color: #dc3545;
            background-color: #f8d7da;
        }
        .loading {
            border-color: #ffc107;
            background-color: #fff3cd;
        }
        .status {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
            margin-left: 10px;
        }
        .status.success {
            background: #28a745;
            color: white;
        }
        .status.error {
            background: #dc3545;
            color: white;
        }
        .status.loading {
            background: #ffc107;
            color: #212529;
        }
    </style>
</head>
<body>
    <h1>FitChallenge API集成测试页面</h1>
    
    <div class="container">
        <h2>测试说明</h2>
        <p>此页面用于测试前端与后端API的集成情况。请确保：</p>
        <ul>
            <li>后端服务器已启动 (http://localhost:3000)</li>
            <li>前端服务器已启动 (http://localhost:8080)</li>
            <li>用户已登录并获取到有效token</li>
        </ul>
    </div>

    <div class="container">
        <h2>API服务测试</h2>
        
        <div class="test-section">
            <h3>1. 测试API服务加载</h3>
            <button class="btn" onclick="testApiServiceLoad()">测试API服务加载</button>
            <div id="apiServiceResult" class="result"></div>
        </div>

        <div class="test-section">
            <h3>2. 测试用户个人资料API</h3>
            <button class="btn" onclick="testUserProfileAPI()">测试获取个人资料</button>
            <button class="btn" onclick="testUpdateProfileAPI()">测试更新个人资料</button>
            <div id="userProfileResult" class="result"></div>
        </div>

        <div class="test-section">
            <h3>3. 测试通知API</h3>
            <button class="btn" onclick="testNotificationsAPI()">测试获取通知列表</button>
            <button class="btn" onclick="testUnreadCountAPI()">测试获取未读数量</button>
            <div id="notificationsResult" class="result"></div>
        </div>

        <div class="test-section">
            <h3>4. 测试系统API</h3>
            <button class="btn" onclick="testSystemAPI()">测试系统概览</button>
            <div id="systemResult" class="result"></div>
        </div>

        <div class="test-section">
            <h3>5. 测试搜索API</h3>
            <button class="btn" onclick="testSearchAPI()">测试全局搜索</button>
            <div id="searchResult" class="result"></div>
        </div>
    </div>

    <div class="container">
        <h2>页面组件测试</h2>
        
        <div class="test-section">
            <h3>1. 测试UserProfile组件</h3>
            <button class="btn" onclick="testUserProfileComponent()">测试UserProfile组件</button>
            <div id="userProfileComponentResult" class="result"></div>
        </div>

        <div class="test-section">
            <h3>2. 测试Notifications组件</h3>
            <button class="btn" onclick="testNotificationsComponent()">测试Notifications组件</button>
            <div id="notificationsComponentResult" class="result"></div>
        </div>
    </div>

    <script type="module">
        import apiService from './services/apiService.js';

        // 将apiService暴露到全局，供测试函数使用
        window.apiService = apiService;

        // 测试API服务加载
        window.testApiServiceLoad = async function() {
            const resultDiv = document.getElementById('apiServiceResult');
            resultDiv.className = 'result loading';
            resultDiv.textContent = '正在测试API服务加载...';

            try {
                // 检查apiService是否正确加载
                if (apiService && typeof apiService.getUserProfile === 'function') {
                    resultDiv.className = 'result success';
                    resultDiv.textContent = '✅ API服务加载成功！\n\n可用方法：\n' + 
                        Object.getOwnPropertyNames(Object.getPrototypeOf(apiService))
                            .filter(name => typeof apiService[name] === 'function')
                            .join('\n');
                } else {
                    throw new Error('API服务未正确加载或方法缺失');
                }
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.textContent = '❌ API服务加载失败：\n' + error.message;
            }
        };

        // 测试用户个人资料API
        window.testUserProfileAPI = async function() {
            const resultDiv = document.getElementById('userProfileResult');
            resultDiv.className = 'result loading';
            resultDiv.textContent = '正在测试用户个人资料API...';

            try {
                const response = await apiService.getUserProfile();
                resultDiv.className = 'result success';
                resultDiv.textContent = '✅ 获取用户个人资料成功！\n\n响应数据：\n' + 
                    JSON.stringify(response, null, 2);
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.textContent = '❌ 获取用户个人资料失败：\n' + error.message;
            }
        };

        // 测试更新个人资料API
        window.testUpdateProfileAPI = async function() {
            const resultDiv = document.getElementById('userProfileResult');
            resultDiv.className = 'result loading';
            resultDiv.textContent = '正在测试更新个人资料API...';

            try {
                const testData = {
                    nickname: '测试用户',
                    bio: '这是一个测试更新'
                };
                const response = await apiService.updateUserProfile(testData);
                resultDiv.className = 'result success';
                resultDiv.textContent = '✅ 更新用户个人资料成功！\n\n请求数据：\n' + 
                    JSON.stringify(testData, null, 2) + '\n\n响应数据：\n' + 
                    JSON.stringify(response, null, 2);
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.textContent = '❌ 更新用户个人资料失败：\n' + error.message;
            }
        };

        // 测试通知API
        window.testNotificationsAPI = async function() {
            const resultDiv = document.getElementById('notificationsResult');
            resultDiv.className = 'result loading';
            resultDiv.textContent = '正在测试通知API...';

            try {
                const response = await apiService.getNotifications();
                resultDiv.className = 'result success';
                resultDiv.textContent = '✅ 获取通知列表成功！\n\n响应数据：\n' + 
                    JSON.stringify(response, null, 2);
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.textContent = '❌ 获取通知列表失败：\n' + error.message;
            }
        };

        // 测试未读通知数量API
        window.testUnreadCountAPI = async function() {
            const resultDiv = document.getElementById('notificationsResult');
            resultDiv.className = 'result loading';
            resultDiv.textContent = '正在测试未读通知数量API...';

            try {
                const response = await apiService.getUnreadNotificationCount();
                resultDiv.className = 'result success';
                resultDiv.textContent = '✅ 获取未读通知数量成功！\n\n响应数据：\n' + 
                    JSON.stringify(response, null, 2);
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.textContent = '❌ 获取未读通知数量失败：\n' + error.message;
            }
        };

        // 测试系统API
        window.testSystemAPI = async function() {
            const resultDiv = document.getElementById('systemResult');
            resultDiv.className = 'result loading';
            resultDiv.textContent = '正在测试系统API...';

            try {
                const response = await apiService.getSystemOverview();
                resultDiv.className = 'result success';
                resultDiv.textContent = '✅ 获取系统概览成功！\n\n响应数据：\n' + 
                    JSON.stringify(response, null, 2);
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.textContent = '❌ 获取系统概览失败：\n' + error.message;
            }
        };

        // 测试搜索API
        window.testSearchAPI = async function() {
            const resultDiv = document.getElementById('searchResult');
            resultDiv.className = 'result loading';
            resultDiv.textContent = '正在测试搜索API...';

            try {
                const response = await apiService.globalSearch({ query: 'test' });
                resultDiv.className = 'result success';
                resultDiv.textContent = '✅ 全局搜索成功！\n\n响应数据：\n' + 
                    JSON.stringify(response, null, 2);
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.textContent = '❌ 全局搜索失败：\n' + error.message;
            }
        };

        // 测试UserProfile组件
        window.testUserProfileComponent = async function() {
            const resultDiv = document.getElementById('userProfileComponentResult');
            resultDiv.className = 'result loading';
            resultDiv.textContent = '正在测试UserProfile组件...';

            try {
                // 动态导入UserProfile组件
                const UserProfileModule = await import('./pages/UserProfile.js');
                const UserProfile = UserProfileModule.default;
                
                if (UserProfile) {
                    resultDiv.className = 'result success';
                    resultDiv.textContent = '✅ UserProfile组件加载成功！\n\n组件信息：\n' + 
                        '构造函数：' + UserProfile.name + '\n' +
                        '原型方法：' + Object.getOwnPropertyNames(UserProfile.prototype).join(', ');
                } else {
                    throw new Error('UserProfile组件未正确导出');
                }
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.textContent = '❌ UserProfile组件测试失败：\n' + error.message;
            }
        };

        // 测试Notifications组件
        window.testNotificationsComponent = async function() {
            const resultDiv = document.getElementById('notificationsComponentResult');
            resultDiv.className = 'result loading';
            resultDiv.textContent = '正在测试Notifications组件...';

            try {
                // 动态导入Notifications组件
                const NotificationsModule = await import('./pages/Notifications.js');
                const Notifications = NotificationsModule.default;
                
                if (Notifications) {
                    resultDiv.className = 'result success';
                    resultDiv.textContent = '✅ Notifications组件加载成功！\n\n组件信息：\n' + 
                        '构造函数：' + Notifications.name + '\n' +
                        '原型方法：' + Object.getOwnPropertyNames(Notifications.prototype).join(', ');
                } else {
                    throw new Error('Notifications组件未正确导出');
                }
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.textContent = '❌ Notifications组件测试失败：\n' + error.message;
            }
        };

        console.log('API测试页面已加载，apiService:', apiService);
    </script>
</body>
</html>
